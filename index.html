<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cara Brown — Job Application Toolkit</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@300;400&family=Instrument+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0d0d0d;
    --paper: #ffffff;
    --cream: #f5f2eb;
    --gold: #0d0d0d;
    --gold-light: #333333;
    --rust: #0d0d0d;
    --muted: #666666;
    --border: #e0e0e0;
    --success: #2a5a35;
    --warn: #7a5a00;
    --panel: #ffffff;
    --shadow: rgba(0,0,0,0.06);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 16px; }
  body {
    font-family: 'Instrument Sans', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
  }

  /* ─── HEADER ─── */
  header {
    background: #000000;
    padding: 2rem 3rem;
    display: flex;
    align-items: baseline;
    gap: 2rem;
    border-bottom: 2px solid var(--gold);
  }
  header h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.2rem;
    font-weight: 300;
    color: var(--paper);
    letter-spacing: 0.02em;
  }
  header h1 em {
    font-style: italic;
    color: var(--gold-light);
  }
  header .sub {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 0.2rem;
  }

  /* ─── LAYOUT ─── */
  .app {
    display: grid;
    grid-template-columns: 260px 1fr;
    min-height: calc(100vh - 90px);
  }

  /* ─── SIDEBAR NAV ─── */
  nav {
    background: var(--ink);
    padding: 2.5rem 0;
    position: sticky;
    top: 0;
    height: calc(100vh - 90px);
    overflow-y: auto;
    border-right: 1px solid #1e1e1c;
  }
  nav ul { list-style: none; }
  nav ul li { border-bottom: 1px solid #1a1a18; }
  nav ul li a {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 0.9rem 1.5rem;
    color: #a09890;
    text-decoration: none;
    font-size: 0.78rem;
    letter-spacing: 0.05em;
    font-family: 'DM Mono', monospace;
    transition: all 0.2s;
    cursor: pointer;
  }
  nav ul li a:hover { color: var(--gold-light); background: #141412; }
  nav ul li a.active { color: #000000; background: #141412; border-left: 2px solid var(--gold); }
  nav ul li a .num {
    font-size: 0.6rem;
    color: #3a3a38;
    width: 16px;
    text-align: right;
  }
  nav ul li a.active .num { color: #000000; opacity: 0.5; }
  .nav-section {
    padding: 1.5rem 1.5rem 0.5rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: #3a3a38;
  }

  /* ─── MAIN CONTENT ─── */
  main {
    overflow-y: auto;
    height: calc(100vh - 90px);
  }
  .panel {
    display: none;
    padding: 3rem;
    max-width: 1100px;
    animation: fadeIn 0.3s ease;
  }
  .panel.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .panel-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.8rem;
    font-weight: 300;
    margin-bottom: 0.3rem;
    line-height: 1.1;
  }
  .panel-title em { font-style: italic; color: #000000; }
  .panel-desc {
    color: var(--muted);
    font-size: 0.85rem;
    margin-bottom: 2.5rem;
    line-height: 1.6;
  }
  .divider {
    width: 48px;
    height: 1px;
    background: #000000;
    margin: 1rem 0 2rem;
  }

  /* ─── FORM ELEMENTS ─── */
  label {
    display: block;
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.5rem;
  }
  textarea, input[type="url"], input[type="text"] {
    width: 100%;
    background: var(--panel);
    border: 1px solid var(--border);
    color: var(--ink);
    font-family: 'Instrument Sans', sans-serif;
    font-size: 0.88rem;
    line-height: 1.6;
    padding: 1rem 1.2rem;
    border-radius: 4px;
    resize: vertical;
    transition: border-color 0.2s;
    margin-bottom: 1.5rem;
  }
  textarea:focus, input:focus {
    outline: none;
    border-color: #000000;
  }
  textarea { min-height: 180px; }
  input[type="url"], input[type="text"] { min-height: unset; }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

  /* ─── BUTTONS ─── */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 2rem;
    background: #000000;
    color: #ffffff;
    border: none;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    border-radius: 0;
    transition: all 0.15s;
  }
  .btn:hover { background: #000000; color: var(--ink); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .btn-ghost {
    background: transparent;
    border-color: var(--border);
    color: var(--muted);
  }
  .btn-ghost:hover { border-color: #000000; color: #000000; background: transparent; }
  .btn-row { display: flex; gap: 1rem; margin-top: 0.5rem; }

  /* ─── RESUME PILLS ─── */
  .resume-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  .pill {
    padding: 0.4rem 1rem;
    border: 1px solid var(--border);
    border-radius: 20px;
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.03em;
  }
  .pill.selected {
    background: var(--ink);
    color: #000000;
    border-color: #000000;
  }
  .pill:hover:not(.selected) { border-color: var(--ink); color: var(--ink); }

  /* ─── RESULTS ─── */
  .result-box {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1.5rem;
    margin-top: 1.5rem;
    display: none;
  }
  .result-box.visible { display: block; }
  .result-box h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.2rem;
    font-weight: 400;
    margin-bottom: 1rem;
  }

  .score-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .score-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem;
    text-align: center;
    transition: transform 0.2s;
  }
  .score-card:hover { transform: translateY(-2px); }
  .score-card .score-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.4rem;
    font-weight: 600;
    line-height: 1;
    margin-bottom: 0.3rem;
  }
  .score-card .score-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    line-height: 1.4;
  }
  .score-high { color: var(--success); }
  .score-mid { color: var(--warn); }
  .score-low { color: var(--rust); }

  .result-prose {
    font-size: 0.88rem;
    line-height: 1.75;
    color: var(--ink);
    white-space: pre-wrap;
  }
  .result-prose strong { font-weight: 600; }

  /* ─── LOADING ─── */
  .loading {
    display: none;
    align-items: center;
    gap: 0.8rem;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    margin-top: 1rem;
  }
  .loading.visible { display: flex; }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid var(--border);
    border-top-color: #000000;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .copy-btn {
    float: right;
    padding: 0.3rem 0.8rem;
    font-size: 0.6rem;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    cursor: pointer;
    border-radius: 3px;
    letter-spacing: 0.08em;
    transition: all 0.2s;
    margin-bottom: 0.5rem;
  }
  .copy-btn:hover { border-color: #000000; color: #000000; }

  /* ─── STEP INDICATOR ─── */
  .step-hint {
    background: var(--cream);
    border-left: 3px solid var(--gold);
    padding: 0.8rem 1.2rem;
    font-size: 0.8rem;
    color: var(--muted);
    border-radius: 0 4px 4px 0;
    margin-bottom: 2rem;
    line-height: 1.5;
  }

  /* ─── STREAMED TEXT ─── */
  .stream-output {
    font-size: 0.88rem;
    line-height: 1.75;
    color: var(--ink);
    white-space: pre-wrap;
    min-height: 40px;
  }

  /* ─── TABS ─── */
  .tab-row {
    display: flex;
    gap: 0;
    border-bottom: 1px solid var(--border);
    margin-bottom: 1.5rem;
  }
  .tab {
    padding: 0.6rem 1.2rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.2s;
  }
  .tab.active { color: #000000; border-bottom-color: #000000; }
  .tab:hover:not(.active) { color: var(--ink); }

  /* ─── INFO CHIPS ─── */
  .chip {
    display: inline-block;
    padding: 0.25rem 0.6rem;
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 3px;
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    color: var(--muted);
    letter-spacing: 0.05em;
    margin-right: 0.4rem;
    margin-bottom: 0.4rem;
  }

  @media (max-width: 768px) {
    .app { grid-template-columns: 1fr; }
    nav { display: none; }
    .panel { padding: 1.5rem; }
    .form-row { grid-template-columns: 1fr; }
  }

  .error-msg {
    color: var(--rust);
    font-size: 0.8rem;
    font-family: 'DM Mono', monospace;
    margin-top: 0.5rem;
    display: none;
  }
  .error-msg.visible { display: block; }

  /* ─── SETTINGS MODAL ─── */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(14,14,12,0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal-box {
    background: var(--paper);
    border: 1px solid var(--gold);
    border-radius: 8px;
    padding: 2.5rem;
    width: 540px;
    max-width: 92vw;
    max-height: 88vh;
    overflow-y: auto;
  }
  .modal-box h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    font-weight: 300;
    margin-bottom: 0.3rem;
  }
  .modal-box h2 em { font-style: italic; color: #000000; }
  .modal-box p { font-size: 0.82rem; color: var(--muted); margin-bottom: 1.5rem; line-height: 1.6; }
  .modal-box a { color: #000000; }
  .modal-close { float: right; background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--muted); margin-top: -0.5rem; }
  .key-status {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    padding: 0.4rem 0.8rem;
    border-radius: 3px;
    display: inline-block;
    margin-top: 0.5rem;
  }
  .key-status.set { background: #e6f2ea; color: var(--success); }
  .key-status.unset { background: #fdf0e6; color: var(--rust); }

  /* ─── SETTINGS BTN IN HEADER ─── */
  .settings-btn {
    margin-left: auto;
    background: transparent;
    border: 1px solid #3a3a38;
    color: #a09890;
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 3px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    white-space: nowrap;
  }
  .settings-btn:hover { border-color: #000000; color: #000000; }
  .settings-btn.key-set { border-color: var(--success); color: var(--success); }

  /* ─── JOB TRACKER ─── */
  .tracker-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2.5rem;
  }
  .stat-card {
    background: var(--ink);
    color: var(--paper);
    border-radius: 6px;
    padding: 1.2rem;
    text-align: center;
  }
  .stat-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.8rem;
    font-weight: 600;
    color: #000000;
    line-height: 1;
    margin-bottom: 0.3rem;
  }
  .stat-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    color: #a09890;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    line-height: 1.4;
  }
  .stat-sub {
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    color: #605a52;
    margin-top: 0.3rem;
  }
  .goal-bar-wrap {
    grid-column: 1 / -1;
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem 1.2rem;
  }
  .goal-bar-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
    display: flex;
    justify-content: space-between;
  }
  .goal-bar-track {
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
  }
  .goal-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), var(--gold-light));
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  .add-job-form {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }
  .add-job-form h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    font-weight: 400;
    margin-bottom: 1rem;
  }
  .job-form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  .job-form-grid .full { grid-column: 1 / -1; }

  .jobs-table-wrap { overflow-x: auto; }
  .jobs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.82rem;
  }
  .jobs-table th {
    font-family: 'DM Mono', monospace;
    font-size: 0.58rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    padding: 0.6rem 0.8rem;
    border-bottom: 2px solid var(--border);
    text-align: left;
    white-space: nowrap;
  }
  .jobs-table td {
    padding: 0.8rem 0.8rem;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }
  .jobs-table tr:hover td { background: var(--cream); }
  .jobs-table tr.hired-row td { background: #e8f5ec; }

  .stage-checks {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }
  .stage-check-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.5rem;
    color: var(--muted);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
  .stage-check-item input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: #000000;
    cursor: pointer;
    margin: 0;
  }
  .delete-job-btn {
    background: none;
    border: none;
    color: var(--border);
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
    padding: 0.2rem;
    transition: color 0.2s;
  }
  .delete-job-btn:hover { color: var(--rust); }
  .applied-date {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    color: var(--muted);
    white-space: nowrap;
  }
  .job-link { color: #000000; text-decoration: none; font-size: 0.75rem; }
  .job-link:hover { text-decoration: underline; }
  .empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
  }

  @media (max-width: 768px) {
    .tracker-stats { grid-template-columns: 1fr 1fr; }
    .job-form-grid { grid-template-columns: 1fr; }
    .job-form-grid .full { grid-column: 1; }
  }


  /* ─── LINE EDITS DIFF STYLE ─── */
  .edit-block {
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 1.2rem;
    overflow: hidden;
    font-size: 0.84rem;
  }
  .edit-block-header {
    background: var(--cream);
    padding: 0.5rem 1rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .edit-section-label {
    background: var(--ink);
    color: #000000;
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    padding: 0.2rem 0.6rem;
    border-radius: 3px;
    letter-spacing: 0.08em;
  }
  .edit-row-before {
    background: #fff5f5;
    border-left: 3px solid #e08080;
    padding: 0.7rem 1rem;
    color: #7a3030;
    line-height: 1.6;
    border-bottom: 1px solid #ffd6d6;
  }
  .edit-row-after {
    background: #f0f7f2;
    border-left: 3px solid var(--success);
    padding: 0.7rem 1rem;
    color: #1e4a2a;
    line-height: 1.6;
    border-bottom: 1px solid #c8e6d0;
  }
  .edit-row-why {
    background: var(--panel);
    padding: 0.6rem 1rem;
    color: var(--muted);
    font-size: 0.78rem;
    font-style: italic;
    line-height: 1.5;
  }
  .edit-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-right: 0.5rem;
    opacity: 0.6;
  }
  .edits-summary-bar {
    background: var(--ink);
    color: var(--paper);
    padding: 1rem 1.2rem;
    border-radius: 6px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-wrap: wrap;
  }
  .edits-summary-bar .summary-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 600;
    color: #000000;
    line-height: 1;
  }
  .edits-summary-bar .summary-text {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    color: #a09890;
    letter-spacing: 0.06em;
    line-height: 1.5;
  }
  .projected-score {
    margin-left: auto;
    text-align: right;
  }
  .projected-score .score-big {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.4rem;
    font-weight: 600;
    color: var(--success);
    line-height: 1;
  }
  .projected-score .score-tiny {
    font-family: 'DM Mono', monospace;
    font-size: 0.55rem;
    color: #605a52;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

</style>
</head>
<body>

<header>
  <div>
    <h1>Cara Brown — <em>Job Application Toolkit</em></h1>
    <div class="sub">ATS Analysis · Cover Letters · Interview Prep · Company Research · Salary &amp; Recruiter Intel</div>
  </div>
  <button class="settings-btn" id="settings-open-btn">⚙ API Key</button>
</header>

<!-- SETTINGS MODAL -->
<div class="modal-overlay" id="settings-modal">
  <div class="modal-box">
    <button class="modal-close" id="settings-close-btn">✕</button>
    <h2>API <em>Settings</em></h2>
    <p>This toolkit calls the Anthropic API directly. Paste your API key below — it's saved only in your browser's local storage and never sent anywhere except Anthropic.<br><br>
    Get your key at <a href="https://console.anthropic.com/settings/keys" target="_blank">console.anthropic.com/settings/keys</a>. Log in, click <strong>API Keys</strong> in the left sidebar, then <strong>Create Key</strong>. Usage is billed to your Anthropic account at very low cost (~$0.01–0.05 per use).</p>

    <label>Anthropic API Key</label>
    <input type="password" id="api-key-input" placeholder="sk-ant-api03-..." style="margin-bottom:1rem;">
    <div class="btn-row">
      <button class="btn" id="save-key-btn">Save Key</button>
      <button class="btn btn-ghost" id="clear-key-btn">Clear Key</button>
    </div>
    <div id="key-status-msg" class="key-status unset" style="margin-top:1rem;">No API key saved</div>

    <hr style="border:none;border-top:1px solid var(--border);margin:1.8rem 0;">
    <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:300;margin-bottom:0.3rem;">Resume <em style="font-style:italic;color:var(--gold);">Links</em></h2>
    <p style="font-size:0.82rem;color:var(--muted);margin-bottom:1.2rem;line-height:1.6;">Save your GoDaddy resume URLs here so you can copy and paste them instantly when applications ask you to link or upload a resume. These are stored in your browser.</p>

    <div id="resume-links-form">
      <label>Principal Design Strategist</label>
      <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem;">
        <input type="url" id="rl-principal-ds" placeholder="https://caraabrown.com/Resumes/..." style="margin-bottom:0;">
        <button class="copy-btn" style="white-space:nowrap;margin:0;" onclick="copyResumeLink('rl-principal-ds')">Copy</button>
      </div>
      <label>Design Strategist (Brief)</label>
      <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem;">
        <input type="url" id="rl-principal-ds-brief" placeholder="https://caraabrown.com/Resumes/..." style="margin-bottom:0;">
        <button class="copy-btn" style="white-space:nowrap;margin:0;" onclick="copyResumeLink('rl-principal-ds-brief')">Copy</button>
      </div>
      <label>Principal Service Designer</label>
      <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem;">
        <input type="url" id="rl-service-designer" placeholder="https://caraabrown.com/Resumes/..." style="margin-bottom:0;">
        <button class="copy-btn" style="white-space:nowrap;margin:0;" onclick="copyResumeLink('rl-service-designer')">Copy</button>
      </div>
      <label>Lead Product Designer</label>
      <div style="display:flex;gap:0.5rem;margin-bottom:0.8rem;">
        <input type="url" id="rl-product-designer" placeholder="https://caraabrown.com/Resumes/..." style="margin-bottom:0;">
        <button class="copy-btn" style="white-space:nowrap;margin:0;" onclick="copyResumeLink('rl-product-designer')">Copy</button>
      </div>
      <label>Chief of Staff</label>
      <div style="display:flex;gap:0.5rem;margin-bottom:1.2rem;">
        <input type="url" id="rl-chief-of-staff" placeholder="https://caraabrown.com/Resumes/..." style="margin-bottom:0;">
        <button class="copy-btn" style="white-space:nowrap;margin:0;" onclick="copyResumeLink('rl-chief-of-staff')">Copy</button>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn" id="save-resume-links-btn">Save Resume Links</button>
    </div>
    <div id="resume-links-saved-msg" style="display:none;margin-top:0.8rem;color:var(--success);font-family:'DM Mono',monospace;font-size:0.65rem;letter-spacing:0.1em;">✓ LINKS SAVED</div>
  </div>
</div>

<div class="app">
  <!-- SIDEBAR NAV -->
  <nav>
    <div class="nav-section">Setup</div>
    <ul>
      <li><a href="#" class="active" data-panel="job-input"><span class="num">01</span> Job Description</a></li>
    </ul>
    <div class="nav-section">Analysis</div>
    <ul>
      <li><a href="#" data-panel="ats-check"><span class="num">02</span> ATS Check</a></li>
      <li><a href="#" data-panel="line-edits"><span class="num">03</span> Line-by-Line Edits</a></li>
      <li><a href="#" data-panel="resume-update"><span class="num">04</span> Revised Resume Check</a></li>
    </ul>
    <div class="nav-section">Application</div>
    <ul>
      <li><a href="#" data-panel="cover-letter"><span class="num">04</span> Cover Letter</a></li>
      <li><a href="#" data-panel="why-this-job"><span class="num">05</span> Why This Job</a></li>
      <li><a href="#" data-panel="custom-qa"><span class="num">06</span> Custom Q&amp;A</a></li>
    </ul>
    <div class="nav-section">Tracker</div>
    <ul>
      <li><a href="#" data-panel="job-tracker"><span class="num">07</span> Job Tracker</a></li>
    </ul>
    <div class="nav-section">Intelligence</div>
    <ul>
      <li><a href="#" data-panel="company-research"><span class="num">08</span> Company Research</a></li>
      <li><a href="#" data-panel="interview-prep"><span class="num">09</span> Interview Prep</a></li>
      <li><a href="#" data-panel="linkedin-outreach"><span class="num">10</span> LinkedIn Outreach</a></li>
      <li><a href="#" data-panel="salary-intel"><span class="num">11</span> Salary &amp; Recruiter Intel</a></li>
    </ul>
  </nav>

  <!-- MAIN -->
  <main>

    <!-- ── PANEL 1: JOB DESCRIPTION ── -->
    <div class="panel active" id="panel-job-input">
      <div class="panel-title">Job <em>Description</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Paste the job description and add the posting URL. This becomes the foundation for every other tool on this microsite.</div>

      <label>Job Description *</label>
      <textarea id="jd-text" placeholder="Paste the full job description here…" rows="14"></textarea>

      <label>Job Posting URL</label>
      <input type="url" id="jd-url" placeholder="https://company.com/careers/job-title">

      <label>Company & Role (optional, helps with cover letter tone)</label>
      <input type="text" id="job-role-name" placeholder="e.g., Principal Service Designer at Accenture Federal Services">

      <div class="btn-row">
        <button class="btn" id="save-jd-btn">Save & Continue →</button>
      </div>
      <div id="jd-saved-msg" style="display:none; margin-top:1rem; color: var(--success); font-family: 'DM Mono', monospace; font-size: 0.7rem; letter-spacing: 0.1em;">✓ JOB DESCRIPTION SAVED</div>
    </div>

    <!-- ── PANEL 2: ATS CHECK ── -->
    <div class="panel" id="panel-ats-check">
      <div class="panel-title">ATS <em>Analysis</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Run an ATS keyword and relevance analysis against all five of your resumes. Each will be scored 0–100%, with detailed suggestions to push the best match above 95%.</div>

      <div class="step-hint">Make sure you've saved a job description in step 01 before running this analysis.</div>

      <label>Resumes to analyze</label>
      <div class="resume-pills">
        <div class="pill" data-resume="principal_ds">Principal Design Strategist</div>
        <div class="pill" data-resume="principal_ds_brief">Design Strategist (Brief)</div>
        <div class="pill" data-resume="service_designer">Principal Service Designer</div>
        <div class="pill" data-resume="product_designer">Lead Product Designer</div>
        <div class="pill" data-resume="chief_of_staff">Chief of Staff</div>
      </div>

      <div class="btn-row">
        <button class="btn" id="run-ats-btn">Run ATS Analysis</button>
      </div>

      <div class="loading" id="ats-loading"><div class="spinner"></div>Analyzing all resumes…</div>
      <div class="error-msg" id="ats-error"></div>

      <div class="result-box" id="ats-result">
        <h3>ATS Score Summary</h3>
        <div class="score-cards" id="score-cards-container"></div>
        <div class="tab-row" id="ats-output-tabs" style="margin-top:1.5rem;display:none;">
          <div class="tab active" data-atssec="flags">Red Flags &amp; ATS Notes</div>
          <div class="tab" data-atssec="summary">Fastest Path to 95%+</div>
        </div>
        <div id="ats-flags-output" class="stream-output" style="display:none;"></div>
        <div id="ats-summary-output" class="stream-output" style="display:none;"></div>
        <div id="ats-detail-output" class="stream-output"></div>
      </div>
    </div>


    <!-- ── PANEL 3: LINE-BY-LINE EDITS ── -->
    <div class="panel" id="panel-line-edits">
      <div class="panel-title">Line-by-Line <em>Edits</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Takes the highest-scoring resume from your ATS analysis and gives you exact, line-by-line rewrites — every change needed to push your score above 95%. Each edit shows the original line, the rewritten version, and why it improves your ATS match.</div>

      <div class="step-hint">Run the ATS Analysis first (Step 02) so this tool knows which resume scored highest. It will automatically use that resume as the base.</div>

      <label>Which resume to edit</label>
      <div class="resume-pills" id="le-resume-pills">
        <div class="pill selected" data-resume="principal_ds">Principal Design Strategist</div>
        <div class="pill" data-resume="principal_ds_brief">Design Strategist (Brief)</div>
        <div class="pill" data-resume="service_designer">Principal Service Designer</div>
        <div class="pill" data-resume="product_designer">Lead Product Designer</div>
        <div class="pill" data-resume="chief_of_staff">Chief of Staff</div>
      </div>

      <div class="step-hint" id="le-auto-hint" style="display:none; border-color: var(--success); background: #f0f7f2;">
        ✓ Auto-selected <strong id="le-auto-resume-name"></strong> — the highest scorer from your ATS analysis.
      </div>

      <div class="btn-row">
        <button class="btn" id="gen-edits-btn">Generate Line-by-Line Edits</button>
      </div>

      <div class="loading" id="le-loading"><div class="spinner"></div>Analyzing and rewriting for maximum ATS score…</div>
      <div class="error-msg" id="le-error"></div>

      <div class="result-box" id="le-result">
        <div style="margin-bottom:1rem;">
          <h3 style="margin:0;">Edits to Apply</h3>
        </div>
        <div class="stream-output" id="le-output"></div>
      </div>
    </div>

    <!-- ── PANEL 3: REVISED RESUME CHECK ── -->
    <div class="panel" id="panel-resume-update">
      <div class="panel-title">Revised Resume <em>Check</em></div>
      <div class="divider"></div>
      <div class="panel-desc">After applying the suggested edits, paste your updated resume here for a fresh ATS score.</div>

      <label>Updated Resume Text *</label>
      <textarea id="updated-resume-text" placeholder="Paste your updated resume text here…" rows="14"></textarea>

      <div class="btn-row">
        <button class="btn" id="recheck-btn">Re-run ATS Check</button>
      </div>

      <div class="loading" id="recheck-loading"><div class="spinner"></div>Analyzing revised resume…</div>
      <div class="error-msg" id="recheck-error"></div>

      <div class="result-box" id="recheck-result">
        <div class="tab-row" id="recheck-tabs" style="margin-bottom:1rem;">
          <div class="tab active" data-rcsec="keywords">Missing Keywords</div>
          <div class="tab" data-rcsec="improvement">Score Improvement</div>
          <div class="tab" data-rcsec="gaps">Remaining Gaps</div>
          <div class="tab" data-rcsec="ready">Ready to Submit?</div>
        </div>
        <div id="recheck-keywords-output" class="stream-output"></div>
        <div id="recheck-improvement-output" class="stream-output" style="display:none;"></div>
        <div id="recheck-gaps-output" class="stream-output" style="display:none;"></div>
        <div id="recheck-ready-output" class="stream-output" style="display:none;"></div>
        <div class="stream-output" id="recheck-output" style="display:none;"></div>
      </div>
    </div>

    <!-- ── PANEL 4: COVER LETTER ── -->
    <div class="panel" id="panel-cover-letter">
      <div class="panel-title">Cover <em>Letter</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Generates a personalized cover letter using your resumes and website (caraabrown.com). The letter will reference specific accomplishments and tie them to the job requirements.</div>

      <label>Resume to reference</label>
      <div class="resume-pills" id="cl-resume-pills">
        <div class="pill selected" data-resume="principal_ds">Principal Design Strategist</div>
        <div class="pill" data-resume="principal_ds_brief">Design Strategist (Brief)</div>
        <div class="pill" data-resume="service_designer">Principal Service Designer</div>
        <div class="pill" data-resume="product_designer">Lead Product Designer</div>
        <div class="pill" data-resume="chief_of_staff">Chief of Staff</div>
      </div>

      <label>Tone preference</label>
      <div class="tab-row" id="cl-tone">
        <div class="tab active" data-tone="strategic">Strategic & Precise</div>
        <div class="tab" data-tone="warm">Warm & Personal</div>
        <div class="tab" data-tone="executive">Executive Confidence</div>
      </div>

      <div class="btn-row">
        <button class="btn" id="gen-cl-btn">Generate Cover Letter</button>
      </div>

      <div class="loading" id="cl-loading"><div class="spinner"></div>Crafting your cover letter…</div>
      <div class="error-msg" id="cl-error"></div>

      <div class="result-box" id="cl-result">
        <div style="display:flex;gap:0.5rem;margin-bottom:0.75rem;">
          <button class="copy-btn" style="float:none;margin:0;" onclick="copyResult('cl-output')">Copy</button>
          <button class="copy-btn" style="float:none;margin:0;" onclick="downloadCLasPDF()">Download PDF</button>
        </div>
        <div class="stream-output" id="cl-output"></div>
      </div>
    </div>

    <!-- ── PANEL 5: WHY THIS JOB ── -->
    <div class="panel" id="panel-why-this-job">
      <div class="panel-title">Why <em>This Job</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Generates a compelling, authentic answer to "Why do you want this role?" and "Why would you be a great fit?" — grounded in your actual experience and the specific job requirements.</div>

      <label>Additional context (optional)</label>
      <textarea id="why-context" placeholder="Add any personal notes, things that specifically excited you about this role, the company, or the team…" rows="5"></textarea>

      <div class="btn-row">
        <button class="btn" id="gen-why-btn">Generate Answer</button>
      </div>

      <div class="loading" id="why-loading"><div class="spinner"></div>Writing your response…</div>
      <div class="error-msg" id="why-error"></div>

      <div class="result-box" id="why-result">
        <button class="copy-btn" onclick="copyResult('why-output')">Copy</button>
        <div class="stream-output" id="why-output"></div>
      </div>
    </div>

    <!-- ── PANEL 6: CUSTOM Q&A ── -->
    <div class="panel" id="panel-custom-qa">
      <div class="panel-title">Application <em>Q&amp;A</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Paste any application question here — "Describe a time you led change," "What's your leadership philosophy," etc. — and get a tailored answer drawn from your experience.</div>

      <label>Application Question *</label>
      <textarea id="custom-question" placeholder="e.g., Describe a time you had to influence without authority to drive enterprise-wide change…" rows="5"></textarea>

      <label>Word limit (optional)</label>
      <input type="text" id="word-limit" placeholder="e.g., 250 words or ~3 paragraphs">

      <div class="btn-row">
        <button class="btn" id="gen-qa-btn">Generate Answer</button>
      </div>

      <div class="loading" id="qa-loading"><div class="spinner"></div>Writing your response…</div>
      <div class="error-msg" id="qa-error"></div>

      <div class="result-box" id="qa-result">
        <button class="copy-btn" onclick="copyResult('qa-output')">Copy</button>
        <div class="stream-output" id="qa-output"></div>
      </div>
    </div>

    <!-- ── PANEL 7: JOB TRACKER ── -->
    <div class="panel" id="panel-job-tracker">
      <div class="panel-title">Job <em>Tracker</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Track every application in one place. Log jobs, mark your progress through each stage, and watch your weekly momentum build. Goal: 5 applications per day.</div>

      <!-- STATS ROW -->
      <div class="tracker-stats">
        <div class="stat-card">
          <div class="stat-num" id="stat-total">0</div>
          <div class="stat-label">Total Applied</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="stat-week">0</div>
          <div class="stat-label">Applied This Week</div>
          <div class="stat-sub" id="stat-week-goal">Goal: 35 / week</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="stat-active">0</div>
          <div class="stat-label">In Progress</div>
          <div class="stat-sub">(Screening or Interview)</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" id="stat-weeks">—</div>
          <div class="stat-label">Weeks Searching</div>
          <div class="stat-sub" id="stat-since">Since first application</div>
        </div>
        <div class="goal-bar-wrap">
          <div class="goal-bar-label">
            <span>Weekly Progress (Goal: 35 applications)</span>
            <span id="goal-bar-pct">0%</span>
          </div>
          <div class="goal-bar-track">
            <div class="goal-bar-fill" id="goal-bar-fill" style="width:0%"></div>
          </div>
        </div>
      </div>

      <!-- AUTO-LOG NOTE -->
      <div class="step-hint" style="margin-bottom:2rem;">Applications are logged automatically when you save a Job Description in Step 01. Use the checkboxes below to track your progress.</div>

      <!-- JOBS TABLE -->
      <div id="jobs-empty" class="empty-state">No applications logged yet. Add your first one above.</div>
      <div class="jobs-table-wrap" id="jobs-table-wrap" style="display:none;">
        <table class="jobs-table">
          <thead>
            <tr>
              <th>Company</th>
              <th>Role</th>
              <th>Date Added</th>
              <th style="text-align:center;">Screening</th>
              <th style="text-align:center;">Interview</th>
              <th style="text-align:center;">Rejected</th>
              <th style="text-align:center;">Hired</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="jobs-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ── PANEL 7: COMPANY RESEARCH BRIEF ── -->
    <div class="panel" id="panel-company-research">
      <div class="panel-title">Company <em>Research Brief</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Generates a structured intelligence brief on the target company — mission, values, culture signals, recent news, strategic priorities, and exactly how your background maps to their needs. Designed for the depth your MIT coursework emphasized.</div>

      <div class="step-hint">Works best when you've saved a job description. Add the company website or LinkedIn URL for richer results.</div>

      <div class="form-row">
        <div>
          <label>Company Name *</label>
          <input type="text" id="company-name" placeholder="e.g., Accenture Federal Services">
        </div>
        <div>
          <label>Company Website or LinkedIn URL</label>
          <input type="url" id="company-url" placeholder="https://company.com">
        </div>
      </div>

      <label>What do you already know about them? (optional)</label>
      <textarea id="company-notes" placeholder="e.g., I know they're expanding their digital transformation practice, saw they recently won a federal contract, the hiring manager was at USDS…" rows="4"></textarea>

      <label>Research depth</label>
      <div class="tab-row" id="research-depth-tabs">
        <div class="tab active" data-depth="standard">Standard Brief</div>
        <div class="tab" data-depth="deep">Deep Dive</div>
        <div class="tab" data-depth="interview">Pre-Interview</div>
      </div>

      <div class="btn-row">
        <button class="btn" id="gen-research-btn">Generate Research Brief</button>
      </div>

      <div class="loading" id="research-loading"><div class="spinner"></div>Building your intelligence brief…</div>
      <div class="error-msg" id="research-error"></div>

      <div class="result-box" id="research-result">
        <button class="copy-btn" onclick="copyResult('research-output')">Copy</button>
        <div class="stream-output" id="research-output"></div>
      </div>
    </div>

    <!-- ── PANEL 8: INTERVIEW PREP ── -->
    <div class="panel" id="panel-interview-prep">
      <div class="panel-title">Interview <em>Prep Studio</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Generates the 10 most likely interview questions for this specific role, then crafts a tailored STAR-method answer for each one — pulled directly from your real accomplishments. Read these before your interview, not generic tips.</div>

      <div class="step-hint">Save a job description first. The more specific the JD, the sharper the questions and answers.</div>

      <label>Interview stage</label>
      <div class="tab-row" id="interview-stage-tabs">
        <div class="tab active" data-stage="phone">Phone Screen</div>
        <div class="tab" data-stage="hiring">Hiring Manager</div>
        <div class="tab" data-stage="panel">Panel / Final</div>
      </div>

      <label>Resume to draw stories from</label>
      <div class="resume-pills" id="interview-resume-pills">
        <div class="pill selected" data-resume="principal_ds">Principal Design Strategist</div>
        <div class="pill" data-resume="service_designer">Principal Service Designer</div>
        <div class="pill" data-resume="product_designer">Lead Product Designer</div>
        <div class="pill" data-resume="chief_of_staff">Chief of Staff</div>
      </div>

      <label>Anything you want to make sure comes up? (optional)</label>
      <textarea id="interview-focus" placeholder="e.g., I want to make sure I highlight the Kroger NPS story and the $270M trailer finding. I'm nervous about the 'gap' question…" rows="4"></textarea>

      <div class="btn-row">
        <button class="btn" id="gen-interview-btn">Generate Interview Prep</button>
      </div>

      <div class="loading" id="interview-loading"><div class="spinner"></div>Building your prep guide…</div>
      <div class="error-msg" id="interview-error"></div>

      <div class="result-box" id="interview-result">
        <button class="copy-btn" onclick="copyResult('interview-output')">Copy</button>
        <div class="stream-output" id="interview-output"></div>
      </div>
    </div>

    <!-- ── PANEL 9: LINKEDIN OUTREACH ── -->
    <div class="panel" id="panel-linkedin-outreach">
      <div class="panel-title">LinkedIn <em>Outreach</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Craft warm, specific outreach messages — connection requests, informational interview asks, referral requests, or follow-ups after applying. These are written to feel human and earn a reply, not generic InMail.</div>

      <div class="form-row">
        <div>
          <label>Their Name *</label>
          <input type="text" id="li-name" placeholder="e.g., Jordan Reeves">
        </div>
        <div>
          <label>Their Title & Company *</label>
          <input type="text" id="li-title" placeholder="e.g., VP of Design Strategy at Accenture Federal">
        </div>
      </div>

      <label>What do you know about them? (LinkedIn bio, mutual connections, recent posts, etc.)</label>
      <textarea id="li-context" placeholder="e.g., We have 3 mutual connections, she recently posted about human-centered design in government, previously at USDS…" rows="4"></textarea>

      <label>Message type</label>
      <div class="tab-row" id="li-type-tabs">
        <div class="tab active" data-litype="connect">Connection Request</div>
        <div class="tab" data-litype="info">Informational Ask</div>
        <div class="tab" data-litype="referral">Referral Request</div>
        <div class="tab" data-litype="followup">Post-Application Follow-Up</div>
      </div>

      <label>Goal of this outreach</label>
      <textarea id="li-goal" placeholder="e.g., I want to get on her radar before I formally apply, ask for a 20-minute call, learn about the team culture…" rows="3"></textarea>

      <div class="btn-row">
        <button class="btn" id="gen-li-btn">Generate Message</button>
      </div>

      <div class="loading" id="li-loading"><div class="spinner"></div>Crafting your message…</div>
      <div class="error-msg" id="li-error"></div>

      <div class="result-box" id="li-result">
        <button class="copy-btn" onclick="copyResult('li-output')">Copy</button>
        <div class="stream-output" id="li-output"></div>
      </div>
    </div>

    <!-- ── PANEL 10: SALARY & RECRUITER INTEL ── -->
    <div class="panel" id="panel-salary-intel">
      <div class="panel-title">Salary &amp; <em>Recruiter Intel</em></div>
      <div class="divider"></div>
      <div class="panel-desc">Two tools in one: (1) Salary research and negotiation prep — know your number, frame your ask, and handle lowballs. (2) Recruiter vetting — when multiple recruiters reach out for the same role, figure out who's primary, who's a middleman, and how to protect yourself from duplicate submissions.</div>

      <div class="tab-row" id="salary-mode-tabs">
        <div class="tab active" data-salmode="salary">Salary Research &amp; Negotiation</div>
        <div class="tab" data-salmode="recruiter">Recruiter Vetting</div>
      </div>

      <!-- SALARY SUB-PANEL -->
      <div id="salary-sub">
        <label>Role Title *</label>
        <input type="text" id="sal-role" placeholder="e.g., Principal Service Designer, Design Strategy Director">

        <div class="form-row">
          <div>
            <label>Location / Remote</label>
            <input type="text" id="sal-location" placeholder="e.g., Remote, Washington DC, San Francisco">
          </div>
          <div>
            <label>Company Type</label>
            <input type="text" id="sal-company-type" placeholder="e.g., Federal contractor, Fortune 500, Startup, Nonprofit">
          </div>
        </div>

        <label>Salary mentioned in JD or by recruiter (optional)</label>
        <input type="text" id="sal-offered" placeholder="e.g., $130K–$160K, or recruiter said 'around $140K'">

        <label>What happened / your situation (optional)</label>
        <textarea id="sal-situation" placeholder="e.g., Three different recruiters reached out for what looks like the same role at different salary ranges: $130K, $145K, and $165K. I don't know who to respond to or how to negotiate…" rows="4"></textarea>

        <div class="btn-row">
          <button class="btn" id="gen-salary-btn">Research Salary &amp; Build Strategy</button>
        </div>

        <div class="loading" id="salary-loading"><div class="spinner"></div>Researching salary data and building your strategy…</div>
        <div class="error-msg" id="salary-error"></div>

        <div class="result-box" id="salary-result">
          <button class="copy-btn" onclick="copyResult('salary-output')">Copy</button>
          <div class="stream-output" id="salary-output"></div>
        </div>
      </div>

      <!-- RECRUITER VETTING SUB-PANEL -->
      <div id="recruiter-sub" style="display:none;">
        <div class="step-hint">⚠️ Important: In staffing, whoever submits your resume first "owns" your candidacy for that role. If two agencies submit you, the employer may disqualify you entirely. Use this tool to vet before you respond.</div>

        <label>Role you were contacted about *</label>
        <input type="text" id="rec-role" placeholder="e.g., Principal Service Designer at Dept. of Health">

        <label>How many recruiters reached out, and what do you know about each?</label>
        <textarea id="rec-info" placeholder="e.g., Recruiter 1: Sarah at Accenture, mentioned $145K, said role is with a federal client, reached out via LinkedIn. Recruiter 2: 'Mike' from TechStaff Inc, email only, no company details, $130K. Recruiter 3: Jennifer at Booz Allen, $165K, gave me a job req number JR-4821…" rows="6"></textarea>

        <label>Job description or details you have</label>
        <textarea id="rec-jd" placeholder="Paste any JD text, job title, or details shared by any of the recruiters…" rows="5"></textarea>

        <div class="btn-row">
          <button class="btn" id="gen-recruiter-btn">Analyze &amp; Vet Recruiters</button>
        </div>

        <div class="loading" id="recruiter-loading"><div class="spinner"></div>Analyzing recruiter signals…</div>
        <div class="error-msg" id="recruiter-error"></div>

        <div class="result-box" id="recruiter-result">
          <button class="copy-btn" onclick="copyResult('recruiter-output')">Copy</button>
          <div class="stream-output" id="recruiter-output"></div>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
// ─── RESUME CONTENT ───────────────────────────────────────────────────────────
const RESUMES = {
  principal_ds: {
    label: "Principal Design Strategist",
    text: `CARA A. BROWN, MBA — PRINCIPAL DESIGN STRATEGIST + SERVICE DESIGN + ENTERPRISE STRATEGY
(202) 489-9901 · hi@caraabrown.com · linkedin.com/in/caraabrown · caraabrown.com

SYNOPSIS
Principal Design Strategist with 15+ years of experience leading enterprise-scale strategy, service design, and systems transformation across complex, regulated, and multi-stakeholder environments. Trusted partner to C-suite and EVP leaders, translating ambiguity into clear strategic direction, executable roadmaps, and measurable business outcomes.
Expert in enterprise service design, systems thinking, and insight synthesis, driving alignment across Product, Engineering, Operations, Finance, and Legal. Proven record of institutionalizing new metrics, unlocking multi-million-dollar value, and shaping long-horizon strategies through executive-ready narratives and decision frameworks.

CORE COMPETENCIES
DESIGN STRATEGY & ENTERPRISE TRANSFORMATION: Design Strategy | Principal-Level Service Design | Enterprise Experience Strategy | Systems Thinking | Complex Ecosystem Design | Experience Vision & Principles | New Service & New Market Design | Opportunity Framing & Prioritization | Long-Horizon Strategy & Futures Forecasting | Business & Operating Model Design
SERVICE DESIGN & EXPERIENCE ARCHITECTURE: End-to-End Service Design | Service Blueprinting (Enterprise/Multi-System) | Customer Journey Mapping & Orchestration | Lifecycle Experience Design | B2B & Mid-Market Onboarding | Omnichannel Experience Strategy | Experience Prototyping | Feasibility & Adoption Assessment
INSIGHT, RESEARCH & STRATEGIC ANALYSIS: Qualitative & Quantitative Research | Insight Synthesis | Root Cause Analysis | Systems Diagnosis | Operational Diagnostics | Opportunity Sizing | Hypothesis Development | Constraint Identification | Data-Informed Decision Support | Market Informed Concept Validation
STRATEGY EXECUTION & BUSINESS IMPACT: Strategy-to-Execution Translation | Implementation Roadmaps | KPI & Measurement Strategy | Success Metrics Definition | Value Realization | Governance Models | Decision Frameworks | Portfolio-Level Impact Tracking | Strategic Portfolio Management | Investment Prioritization
EXECUTIVE & CROSS-FUNCTIONAL LEADERSHIP: C-Suite & EVP Partnership | Executive Facilitation | Influence Without Authority | Cross-Functional Alignment (Product, Engineering, Operations, Finance, Legal) | Stakeholder Management | Executive Narrative Development | Board & Leadership Materials
OPERATIONAL & ORGANIZATIONAL EFFECTIVENESS: Process Redesign | Workflow Optimization | Capability Mapping | Change Management | Organizational Design | Performance Governance | Operating Cadences | Scalable Systems Building

PROFESSIONAL HISTORY
KROGER | Senior Service Designer, Transportation & Logistics | Cincinnati, OH (Remote) 03/2022 – 09/2025
• Served as Principal Design Strategist on a CEO-identified, enterprise-critical initiative addressing driver experience across 30+ distribution centers, operating as a strategic partner to EVP- and C-suite leaders.
• Led end-to-end enterprise service design across a complex, multi-system ecosystem spanning people, process, policy, and technology; produced executive-ready service blueprints, journey maps, and systems diagnostics.
• Designed and launched an enterprise-wide service health measurement and feedback program driving driver satisfaction from 36% → 74%, NPS from –36 → +49, amenity satisfaction 37% → 78%, unload-time satisfaction 36% → 78%.
• Institutionalized Net Promoter Score (NPS) as a permanent distribution center performance metric; work recognized via Chief HR Officer-led presentation at the Qualtrics Conference.
• Revived a previously stalled enterprise trailer-tracking initiative by quantifying ~$15M/week in loss exposure at a single DC; extrapolated to ~$270M/week enterprise-wide and drove implementation of an enterprise tracking solution.
• Selected to support enterprise-wide TMS/WMS replacement, defining service vision, adoption strategy, and governance; increased system adoption by 20%.
• Co-authored the 2024–2027 Transportation Strategy, extending the enterprise Supply Chain Strategy into a transportation-specific roadmap.
• Selected as one of five senior contributors supporting Kroger–Albertsons merger integration.

THE REALREAL | E-Commerce Center Coordinator - Fine Jewelry & Watches | Brisbane, CA 03/2019 – 03/2021
• Led service and systems redesign across five U.S. e-commerce authentication centers.
• Reduced customer inquiry backlog by 80% (230 → 40), increased inventory control accuracy by 15%, reduced operational shrink by 10%, recovered $50K in high-value inventory.
• Designed a future-state internal authentication service model in response to COVID-19 disruption.

FOSTER BRAND | Principal Design Strategist | Brooklyn, NY 07/2016 - 03/2019
• Led end-to-end design strategy and product leadership for a new market offering.
• Built the business case, financial model, and success metrics; achieved market traction within three months.
• Secured first right of refusal from a national distributor.

LAMONT BISHOP GALLERY | Founding Director, Strategy & Operations | Washington, DC + Brooklyn, NY 05/2010 – Present
• Designed an innovative art gallery business model using design strategy and service design, sustained 15+ years.
• Scaled to three physical locations; international presence at Art Basel across three countries.
• Acquisition and public exhibition of a never-before-seen Basquiat collection.

EAST OAKLAND YOUTH DEVELOPMENT CENTER | Director of Communications & Assessments | Oakland, CA 02/2015 - 07/2016
• Secured a $500K PropelNext grant through data-driven retrospective analysis.
• Raised $31K in two months via #CloseTheGap peer-to-peer fundraising model; won two Gold MarCom Awards.

GARDAWORLD | Global Marketing Coordinator + Employee Communications | Boca Raton, FL 12/2010 - 03/2012
• Led enterprise-wide employee engagement platform launch; 12% reduction in employee theft, 20% increase in job attendance.

EDUCATION
MBA, Design Strategy — California College of the Arts (2014)
BBA, International Business & Marketing — Howard University (2008)
LUMA Practitioner – Human-Centered Design | MIT xPro – Organizational Strategy and Capabilities

TECHNICAL SKILLS: Miro | Mural | FigJam | Figma | Sketch | Adobe Creative Suite | Confluence | Google Workspace | Microsoft Suite`
  },

  principal_ds_brief: {
    label: "Design Strategist (Brief)",
    text: `CARA A. BROWN, MBA — PRINCIPAL DESIGN STRATEGIST + SERVICE DESIGN + ENTERPRISE STRATEGY
(202) 489-9901 · hi@caraabrown.com · caraabrown.com

SYNOPSIS
Principal Design Strategist with 15+ years leading enterprise-scale strategy, service design, and systems transformation. Trusted partner to C-suite and EVP leaders, translating ambiguity into strategic direction, executable roadmaps, and measurable business outcomes.

CORE COMPETENCIES (ABBREVIATED)
Design Strategy | Service Design | Enterprise Experience Strategy | Systems Thinking | Service Blueprinting | Journey Mapping | Qualitative & Quantitative Research | Insight Synthesis | Root Cause Analysis | Strategy-to-Execution | KPI Frameworks | Executive Facilitation | Cross-Functional Leadership | Change Management

KROGER | Senior Service Designer | 03/2022 – 09/2025
• Served as Principal Design Strategist on CEO-identified initiative improving driver experience across 30+ distribution centers.
• Drove satisfaction 36%→74%, NPS –36→+49; institutionalized NPS as permanent enterprise metric recognized at Qualtrics Conference.
• Quantified ~$15M/week in trailer losses at single DC, ~$270M/week enterprise-wide; drove implementation of tracking solution.
• Increased system adoption by 20% on TMS/WMS replacement; co-authored 2024–2027 Transportation Strategy.
• Selected for Kroger–Albertsons merger integration team (one of five).

THE REALREAL | E-Commerce Coordinator | 03/2019 – 03/2021
• Reduced inquiry backlog 80%, improved inventory accuracy 15%, recovered $50K inventory across five authentication centers.

FOSTER BRAND | Principal Design Strategist | 07/2016 - 03/2019
• Led net-new product from concept to market traction in 3 months; secured first right of refusal from national distributor.

LAMONT BISHOP GALLERY | Founding Director | 05/2010 – Present
• Sustained 15+ year gallery operation; scaled to 3 locations, Art Basel international presence, Basquiat collection.

MBA, Design Strategy — California College of the Arts | BBA — Howard University`
  },

  service_designer: {
    label: "Principal Service Designer",
    text: `CARA A BROWN, MBA — DESIGN STRATEGIST + SERVICE DESIGNER + PROBLEM SOLVER
(202) 489-9901 · hi@caraabrown.com · caraabrown.com

SYNOPSIS
Principal Service Designer with 15+ years of experience leading end-to-end service design and digital transformation initiatives across public-sector and enterprise environments. Deep expertise in human-centered design, service research, journey mapping, service blueprinting, and experience prototyping to improve usability, accessibility, and operational efficiency at scale.
Proven leader within cross-functional Agile teams, translating user research and behavioral insights into actionable service improvements, delivery roadmaps, and policy- and operations-aligned recommendations. Known for facilitating co-design workshops with executives, delivery teams, and frontline staff, championing change management, user adoption, and continuous service improvement across complex, multi-stakeholder systems.

HIGHLIGHTS
END-TO-END SERVICE DESIGN & DELIVERY: Service Design & Human-Centered Design | Qualitative Research & Ethnography | Journey Mapping | Service Blueprinting | Systems Mapping & Ecosystem Analysis | Giga Mapping | Insight Synthesis & Problem Framing | Future-State Service Modeling | Business Modeling | Service Requirements & Experience Principles | Implementation & Pilot Planning | Digital Service Design | Accessibility & Inclusive Design | Service Performance Measurement | Continuous Improvement Cycles

FACILITATION, ALIGNMENT & CO-CREATION: Workshop Design & Facilitation | Cross-Functional Alignment (Product, Engineering, Operations, HR) | Executive Briefing | Co-design Workshops | Design Sprints | Stakeholder Alignment Across Ministries/Agencies | Executive & Frontline Facilitation

SYSTEMS THINKING & OPERATIONAL DIAGNOSIS: Systems Diagnosis | Root Cause Analysis | Operational & Workflow Evaluation | Capability Mapping | Constraint Identification | Experience & Process Redesign | Feasibility & Adoption Assessment

TRANSLATING STRATEGY INTO ACTION: Service Strategy Development | Experience Roadmaps | Decision-Support Artifacts | Metrics & Success Definition | KPI Alignment | Agile Backlog Integration | User Stories & Acceptance Criteria | Service KPIs & Outcomes Tracking

TOOLS: Figma | Miro | Adobe Creative Suite | FigJam | Confluence | Microsoft 365

PROFESSIONAL HISTORY
KROGER | Senior Service Designer, Transportation & Logistics | 03/2022 – 09/2025
• Led CEO-identified, enterprise-critical service design initiative addressing driver experience across 20+ distribution centers.
• Designed and deployed enterprise-wide, gamified service feedback and measurement program—journey maps, service blueprints, experience principles.
• Delivered: driver satisfaction 36%→74%, NPS –36→+49; institutionalized NPS as permanent metric, presented at Qualtrics Conference.
• Conducted service design research: user interviews, contextual inquiry, on-site observation with drivers, frontline staff, leadership.
• Facilitated co-design workshops and design sprints with executives, delivery teams, frontline users.
• Revived stalled trailer-tracking initiative: quantified $15M/week losses, integrated into Agile backlogs, user stories, acceptance criteria.
• Led large-scale digital transformation across enterprise platforms collaborating with IT, engineering, policy-adjacent stakeholders.
• Contributed to Kroger–Albertsons merger integration.
• Co-authored 2024–2027 Transportation Strategy: facilitated enterprise kickoff workshops, 1:1 sessions, built KPI framework.

THE REALREAL | E-Commerce Center Coordinator | 03/2019 – 03/2021
• Redesigned end-to-end operational workflows across five U.S. e-commerce centers; 10% reduction in operational shrink.
• Redesigned frontstage/backstage workflows; recovered $50K in high-value jewelry; reduced inquiry backlog 80%.

FOSTER BRAND | Principal Design Strategist | 07/2016 - 03/2019
• Led end-to-end discovery and validation; designed user journeys, service flows, clickable prototype; product–market fit in 3 months.
• Authored product vision, success metrics, user-informed roadmap; investor roadshow resulted in first right of refusal from national distributor.

EDUCATION: MBA Design Strategy, California College of the Arts | BBA, Howard University`
  },

  product_designer: {
    label: "Lead Product Designer",
    text: `CARA A. BROWN, MBA — LEAD PRODUCT DESIGNER + PRODUCT STRATEGY + SYSTEMS DESIGN
(202) 489-9901 · hi@caraabrown.com · caraabrown.com

SYNOPSIS
Lead Product Designer with 15+ years of experience designing and launching net-new digital products, platforms, and services across FinTech-adjacent, enterprise, and regulated environments. Operates at the intersection of product strategy, design execution, and business outcomes, partnering with Product, Engineering, Data, and Executive leadership to translate ambiguity into MVPs, scalable systems, and measurable growth.

CORE COMPETENCIES
PRODUCT DESIGN & STRATEGY: End-to-End Product Design | New Product Development | MVP Definition | Product Discovery | Value Proposition Design | Growth & Experimentation | User Journeys & Flows | High-Fidelity Prototyping | Responsive & Accessible Design
RESEARCH INFORMED DESIGN: User Research (Qual & Quant) | Usability Testing | Behavioral Insights | Metrics & KPIs | Funnel Analysis | Insight Synthesis | Experiment Validation
SYSTEMS & PLATFORMS: Design Systems (Creation & Evolution) | Platform Design | Multi-Surface Experiences (Web & Mobile) | Scalable UX Governance
TOOLS: Figma | FigJam | Miro | Adobe Creative Suite | Confluence | Jira | Google Workspace

PROFESSIONAL HISTORY
KROGER | Sr. Service Designer (Lead Product Designer, Platform & Systems) | 03/2022 – 09/2025
• Led end-to-end product and service design for CEO-identified, enterprise-critical digital initiative spanning 30+ distribution centers.
• Partnered with Product, Engineering, Operations, Finance, HR, Legal to define product strategy, user journeys, MVP scope, and phased rollout.
• Designed and launched new digital service and measurement platform; increased driver satisfaction 36%→74%, NPS –36→+49.
• Defined success metrics and dashboards; institutionalized NPS as permanent enterprise KPI adopted by EVP of Supply Chain.
• Revived stalled digital tracking product; quantified $15M/week loss at single site; scaled across 34 sites to inform enterprise investment.
• Delivered high-fidelity prototypes, service blueprints, and experience principles used by engineering teams.
• Contributed to Kroger–Albertsons merger product and design leadership.
• Co-authored 2024–2027 Transportation Product & Service Strategy; vision, roadmap, KPIs, governance.
• Led discovery, experience vision, and MVP definition for TMS/WMS platform replacement; increased system adoption by 20%.

THE REALREAL | E-Commerce Center Coordinator | 03/2019 – 03/2021
• Designed and improved internal digital tools and workflows across five U.S. fulfillment centers.
• Reduced customer inquiry backlog 80%, improved inventory accuracy 15%, recovered $50K in high-value inventory.

FOSTER BRAND | Principal Design Strategist | 07/2016 - 03/2019
• Led net-new product development from concept through MVP for B2B digital product; first right of refusal from national distributor in 3 months.

EDUCATION: MBA Design Strategy, California College of the Arts | BBA, Howard University`
  },

  chief_of_staff: {
    label: "Chief of Staff",
    text: `CARA A BROWN, MBA — DESIGN STRATEGIST + SERVICE DESIGNER + PROBLEM SOLVER
Chief of Staff–level strategic operator with 10+ years driving enterprise alignment, executive decision-making, organizational clarity, and cross-functional execution.
(202) 489-9901 · hi@caraabrown.com · caraabrown.com

SYNOPSIS
Expert in strategic planning, operating rhythms, annual and quarterly business reviews, OKR and KPI development, and governance systems. Recognized for synthesizing ambiguity, framing critical issues, and delivering executive-ready materials—board updates, performance dashboards, strategic narratives, decision briefs. Trusted advisor to C-suite leaders with deep experience orchestrating multi-disciplinary initiatives. Skilled in building operating models, standardizing workflows, leading cross-functional rhythm-of-business cadences.

HIGHLIGHTS
STRATEGIC PLANNING & EXECUTION: Annual & Quarterly Business Planning | Operating Rhythms | OKR Development & Alignment | KPI & Dashboard Design | Initiative Prioritization | Strategic Roadmapping | Executive Decision Support | Change Management
EXECUTIVE COMMUNICATIONS: Executive-Ready Briefings | Board Materials | Strategic Narratives | Performance Reviews | Messaging Frameworks | Insights Synthesis | Stakeholder Enablement
BUSINESS OPERATIONS: Governance Systems | Process Optimization | Cross-Functional Workflow Design | Operational Diagnostics | Meeting Architecture | Operating Model Development | Resource & Capacity Planning
CROSS-FUNCTIONAL LEADERSHIP: C-Suite Partnership | Influence Without Authority | Executive Stakeholder Management | Partner & Vendor Management | Multi-Team Collaboration (Product, Engineering, HR, Finance, Legal, Operations)
ANALYTICS & PROBLEM SOLVING: Data Analysis & Visualization | Root Cause Identification | Scenario Modeling | Business Performance Monitoring | Research & Insight Synthesis

PROFESSIONAL HISTORY
KROGER | Senior Service Designer, Transportation & Logistics | 03/2022 – 09/2025
• Served as strategic advisor to EVP of Supply Chain on CEO-prioritized enterprise initiative across 20+ distribution centers.
• Built executive decision-making clarity via performance dashboards, KPI frameworks, and insight narratives; quantified ~$50M/week trailer loss.
• Operated in Chief of Staff–style capacity to EVP of Transportation; drove enterprise operations, executive alignment, KPI governance.
• Designed and operationalized 2024–2027 Transportation Strategy; multi-year roadmap with measurable goals and execution mechanisms.
• Directed cross-functional collaboration across Product, Operations, HR, Finance, Engineering, Legal.
• Selected as one of five contributors supporting Kroger–Albertsons merger executive integration work.

THE REALREAL | E-Commerce Center Coordinator | 03/2019 – 03/2021
• Improved performance across five distributed authentication centers through workflow diagnosis and standardized processes.
• Reduced inquiry backlog 80%, increased inventory control 15%; cross-functional liaison across Sales, Gemology, Operations, Authentication.

FOSTER BRAND | Principal Design Strategist | 07/2016 - 03/2019
• Led cross-functional team through full product lifecycle; developed business case, financial model, operational requirements.
• Secured first right of refusal from national distributor.

EAST OAKLAND YOUTH DEVELOPMENT CENTER | Director of Communications & Assessments | 02/2015 - 07/2016
• Secured $500K PropelNext grant through data-driven retrospective analysis and executive narrative.
• Led center-wide modernization of operational and communication workflows; raised $31K in 2 months.

GARDAWORLD | Global Marketing Coordinator + Employee Communications | 12/2010 - 03/2012
• Prepared quarterly board meeting materials; presented to executive board in Montreal.
• Led organization-wide employee experience initiative; improved alignment across distributed teams.

EDUCATION: MBA Design Strategy, California College of the Arts | BBA, Howard University`
  }
};

const CARA_BIO = `Cara A. Brown, MBA is a Principal Design Strategist and Service Designer with 15+ years of experience. Website: caraabrown.com. She specializes in enterprise-scale strategy, service design, and systems transformation. Key career highlights: led CEO-identified Kroger initiative driving NPS from -36 to +49, quantified $270M/week in enterprise risk and drove solutions, co-authored 2024-2027 Transportation Strategy, selected for Kroger-Albertsons merger integration team, secured $500K grant at EOYDC, sustained a 15+ year art gallery business scaling to international Art Basel presence. Education: MBA Design Strategy (California College of the Arts), BBA International Business & Marketing (Howard University). She is known for translating ambiguity into executive-ready narratives and measurable outcomes.`;

// ─── STATE ────────────────────────────────────────────────────────────────────
let savedJD = '';
let savedJDUrl = '';
let savedRoleName = '';
let selectedResumesForATS = new Set();
let selectedResumeForCL = 'principal_ds';
let selectedCLTone = 'strategic';

// ─── NAVIGATION ──────────────────────────────────────────────────────────────
document.querySelectorAll('nav a[data-panel]').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const panelId = link.dataset.panel;
    document.querySelectorAll('nav a').forEach(l => l.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    link.classList.add('active');
    document.getElementById('panel-' + panelId).classList.add('active');
  });
});

// ─── RESUME PILLS (ATS) ───────────────────────────────────────────────────────
document.querySelectorAll('#panel-ats-check .pill').forEach(pill => {
  pill.addEventListener('click', () => {
    pill.classList.toggle('selected');
    const r = pill.dataset.resume;
    if (pill.classList.contains('selected')) selectedResumesForATS.add(r);
    else selectedResumesForATS.delete(r);
  });
});

// ─── COVER LETTER PILLS (single select) ──────────────────────────────────────
document.querySelectorAll('#cl-resume-pills .pill').forEach(pill => {
  pill.addEventListener('click', () => {
    document.querySelectorAll('#cl-resume-pills .pill').forEach(p => p.classList.remove('selected'));
    pill.classList.add('selected');
    selectedResumeForCL = pill.dataset.resume;
  });
});

// ─── COVER LETTER TONE TABS ───────────────────────────────────────────────────
document.querySelectorAll('#cl-tone .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#cl-tone .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    selectedCLTone = tab.dataset.tone;
  });
});

// ─── SAVE JD ──────────────────────────────────────────────────────────────────
document.getElementById('save-jd-btn').addEventListener('click', () => {
  savedJD = document.getElementById('jd-text').value.trim();
  savedJDUrl = document.getElementById('jd-url').value.trim();
  savedRoleName = document.getElementById('job-role-name').value.trim();
  if (!savedJD) { alert('Please paste a job description first.'); return; }
  document.getElementById('jd-saved-msg').style.display = 'block';

  // Auto-add to job tracker
  if (savedRoleName || savedJDUrl) {
    // Parse "Role at Company" from savedRoleName
    let autoRole = savedRoleName, autoCompany = '';
    const atIdx = savedRoleName.lastIndexOf(' at ');
    if (atIdx > 0) {
      autoRole = savedRoleName.substring(0, atIdx).trim();
      autoCompany = savedRoleName.substring(atIdx + 4).trim();
    }
    const newJob = {
      id: Date.now().toString(),
      company: autoCompany || '(see URL)',
      role: autoRole || savedRoleName,
      url: savedJDUrl,
      source: '',
      notes: '',
      dateAdded: new Date().toISOString(),
      screening: false,
      interview: false,
      rejected: false,
      hired: false
    };
    jobs.unshift(newJob);
    saveJobs();
    renderJobs();
  }

  setTimeout(() => {
    document.querySelector('nav a[data-panel="ats-check"]').click();
  }, 800);
});

// ─── API CALL HELPER ─────────────────────────────────────────────────────────
async function callClaude(systemPrompt, userMessage, onChunk) {
  const apiKey = localStorage.getItem('cara_api_key') || '';
  if (!apiKey) {
    throw new Error('No API key saved. Click ⚙ API Key in the header to add your key.');
  }
  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': apiKey,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-5-20250929',
      max_tokens: 4096,
      system: systemPrompt,
      messages: [{ role: 'user', content: userMessage }]
    })
  });

  if (!response.ok) {
    const errBody = await response.text();
    throw new Error('API error ' + response.status + ': ' + errBody);
  }

  const data = await response.json();
  const text = data.content[0].text;
  onChunk(text);
  return text;
}


// ─── ATS CHECK ───────────────────────────────────────────────────────────────
document.getElementById('run-ats-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  if (!jd) { showError('ats-error', 'Please save a job description in Step 01 first.'); return; }
  if (selectedResumesForATS.size === 0) { showError('ats-error', 'Please select at least one resume.'); return; }

  const resumeTexts = [...selectedResumesForATS].map(key => ({
    key,
    label: RESUMES[key].label,
    text: RESUMES[key].text
  }));

  showLoading('ats-loading');
  hideError('ats-error');
  document.getElementById('ats-result').classList.remove('visible');

  const systemPrompt = `You are an expert ATS (Applicant Tracking System) analyst and resume coach. You analyze resumes against job descriptions with deep expertise in keyword matching, skills alignment, and recruiter psychology. Be precise, data-driven, and actionable.`;

  const resumeBlock = resumeTexts.map((r, i) => 'RESUME ' + (i+1) + ': ' + r.label + '\n---\n' + r.text).join('\n\n======\n\n');

  const userMsg = [
    'JOB DESCRIPTION:',
    jd,
    savedRoleName ? 'Role: ' + savedRoleName : null,
    'RESUMES TO ANALYZE:',
    resumeBlock,
    'For each resume give an ATS score 0-100%. Output each score on its own line exactly like: SCORE: [Resume Name] = [XX]%\n\nThen: which resume is the best match and why, top 5-7 missing keywords from the JD, and specific edits to push the best resume above 95%. Quote exact JD phrases when suggesting additions.'
  ].filter(Boolean).join('\n\n');

  try {
    const result = document.getElementById('ats-detail-output');
    result.textContent = '';
    document.getElementById('ats-result').classList.add('visible');

    let fullText = '';
    await callClaude(systemPrompt, userMsg, (text) => {
      // Parse scores for score cards
      document.getElementById('score-cards-container').innerHTML = '';
      const scoreMatches = [...text.matchAll(/SCORE:\s*(.+?)\s*=\s*(\d+)%/g)];
      if (scoreMatches.length > 0) {
        let highestPct = 0;
        let highestKey = null;
        let highestLabel = null;
        const resumeKeyMap = {
          'Principal Design Strategist': 'principal_ds',
          'Design Strategist (Brief)': 'principal_ds_brief',
          'Principal Service Designer': 'service_designer',
          'Lead Product Designer': 'product_designer',
          'Chief of Staff': 'chief_of_staff'
        };
        scoreMatches.forEach(match => {
          const name = match[1].trim();
          const pct = parseInt(match[2]);
          const colorClass = pct >= 80 ? 'score-high' : pct >= 60 ? 'score-mid' : 'score-low';
          document.getElementById('score-cards-container').innerHTML += `
            <div class="score-card">
              <div class="score-num ${colorClass}">${pct}%</div>
              <div class="score-label">${name}</div>
            </div>`;
          if (pct > highestPct) {
            highestPct = pct;
            highestLabel = name;
            // Find matching resume key
            for (const [label, key] of Object.entries(resumeKeyMap)) {
              if (name.includes(label) || label.includes(name)) { highestKey = key; break; }
            }
          }
        });
        // Auto-select best resume for line edits panel
        if (highestKey) autoSelectBestResume(highestKey, highestLabel);
      }
      fullText = text;
      // Strip scores and detailed analysis/winner section, keep only Red Flags & Summary
      let display = text;
      // Remove SCORE lines
      display = display.replace(/SCORE:[^\n]*\n?/g, '');
      // Remove everything from DETAILED ANALYSIS / WINNER up to RED FLAGS
      display = display.replace(/#+\s*(DETAILED ANALYSIS|WINNER)[\s\S]*?(?=#+\s*(RED FLAGS|SUMMARY|$))/gi, '');
      // Render tabs for Red Flags and Summary
      const rfMatch = display.match(/#+\s*RED FLAGS[\s\S]*?(?=#+\s*SUMMARY|$)/i);
      const sumMatch = display.match(/#+\s*SUMMARY[\s\S]*/i);
      if (rfMatch || sumMatch) {
        let tabHtml = '<div class="tab-row ats-detail-tabs" style="margin-bottom:1rem;">';
        if (rfMatch) tabHtml += '<div class="tab active" data-atstab="rf">Red Flags & Wins</div>';
        if (sumMatch) tabHtml += '<div class="tab" data-atstab="sum">Fastest Path to 95%+</div>';
        tabHtml += '</div>';
        tabHtml += rfMatch ? '<div class="ats-tab-content" data-atscontent="rf" style="display:block"><pre style="white-space:pre-wrap;font-family:inherit;font-size:0.85rem;">' + escHtml(rfMatch[0].trim()) + '</pre></div>' : '';
        tabHtml += sumMatch ? '<div class="ats-tab-content" data-atscontent="sum" style="display:none"><pre style="white-space:pre-wrap;font-family:inherit;font-size:0.85rem;">' + escHtml(sumMatch[0].trim()) + '</pre></div>' : '';
        result.innerHTML = tabHtml;
        result.querySelectorAll('.ats-detail-tabs .tab').forEach(t => {
          t.addEventListener('click', () => {
            result.querySelectorAll('.ats-detail-tabs .tab').forEach(x => x.classList.remove('active'));
            t.classList.add('active');
            result.querySelectorAll('.ats-tab-content').forEach(x => x.style.display = 'none');
            const target = result.querySelector('[data-atscontent="' + t.dataset.atstab + '"]');
            if (target) target.style.display = 'block';
          });
        });
      } else {
        result.textContent = display.trim();
      }
    });

  } catch (err) {
    showError('ats-error', 'Something went wrong: ' + err.message);
    document.getElementById('ats-result').classList.remove('visible');
  } finally {
    hideLoading('ats-loading');
  }
});

// ─── REVISED RESUME CHECK ─────────────────────────────────────────────────────
document.getElementById('recheck-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  const updatedResume = document.getElementById('updated-resume-text').value.trim();
  if (!jd) { showError('recheck-error', 'Please save a job description in Step 01 first.'); return; }
  if (!updatedResume) { showError('recheck-error', 'Please paste your updated resume text.'); return; }

  showLoading('recheck-loading');
  hideError('recheck-error');
  document.getElementById('recheck-result').classList.remove('visible');

  const systemPrompt = `You are an expert ATS analyst. Provide precise, actionable resume analysis.`;
  const userMsg = `JOB DESCRIPTION:
${jd}

UPDATED RESUME:
${updatedResume}

Run a comprehensive ATS check on this revised resume:

1. **Overall ATS Score**: Give a percentage (0-100%)
2. **Keyword Match**: List matched keywords and any still missing
3. **Score Improvement**: Compare to what a typical unoptimized resume would score
4. **Remaining Gaps**: Any final tweaks needed to hit 95%+
5. **Ready to Submit?**: Yes/No and why

Be specific and direct.`;

  try {
    const output = document.getElementById('recheck-output');
    output.textContent = '';
    document.getElementById('recheck-result').classList.add('visible');
        await callClaude(systemPrompt, userMsg, (text) => {
      // Render tabs on completion
      const tabs = [
        { key: 'keywords', label: 'Missing Keywords', pattern: /MISSING OR WEAK KEYWORDS([\s\S]*?)(?=SCORE IMPROVEMENT|$)/i },
        { key: 'improvement', label: 'Score Improvement', pattern: /SCORE IMPROVEMENT([\s\S]*?)(?=REMAINING GAPS|$)/i },
        { key: 'gaps', label: 'Remaining Gaps', pattern: /REMAINING GAPS([\s\S]*?)(?=READY TO SUBMIT|$)/i },
        { key: 'ready', label: 'Ready to Submit?', pattern: /READY TO SUBMIT\?([\s\S]*)/i }
      ];
      // Show score at top
      const scoreMatch = text.match(/OVERALL ATS SCORE:\s*(\d+%)/i);
      let html = scoreMatch ? '<div style="font-size:1.4rem;font-weight:700;margin-bottom:1rem;">' + scoreMatch[1] + ' ATS Score</div>' : '';
      // Build tabs
      const validTabs = tabs.filter(t => t.pattern.test(text));
      if (validTabs.length > 0) {
        html += '<div class="tab-row recheck-tabs" style="margin-bottom:1rem;">';
        validTabs.forEach((t, i) => { html += '<div class="tab' + (i===0?' active':'') + '" data-rctab="' + t.key + '">' + t.label + '</div>'; });
        html += '</div>';
        validTabs.forEach((t, i) => {
          const match = text.match(t.pattern);
          const content = match ? match[1].trim() : '';
          html += '<div class="recheck-tab-content" data-rccontent="' + t.key + '" style="display:' + (i===0?'block':'none') + '"><pre style="white-space:pre-wrap;font-family:inherit;font-size:0.85rem;">' + escHtml(content) + '</pre></div>';
        });
        output.innerHTML = html;
        output.querySelectorAll('.recheck-tabs .tab').forEach(tab => {
          tab.addEventListener('click', () => {
            output.querySelectorAll('.recheck-tabs .tab').forEach(x => x.classList.remove('active'));
            tab.classList.add('active');
            output.querySelectorAll('.recheck-tab-content').forEach(x => x.style.display = 'none');
            const target = output.querySelector('[data-rccontent="' + tab.dataset.rctab + '"]');
            if (target) target.style.display = 'block';
          });
        });
      } else {
        output.textContent = text;
      }
    });
  } catch (err) {
    showError('recheck-error', 'Something went wrong: ' + err.message);
    document.getElementById('recheck-result').classList.remove('visible');
  } finally {
    hideLoading('recheck-loading');
  }
});

// ─── COVER LETTER ─────────────────────────────────────────────────────────────
document.getElementById('gen-cl-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  if (!jd) { showError('cl-error', 'Please save a job description in Step 01 first.'); return; }

  const resume = RESUMES[selectedResumeForCL];
  const toneMap = {
    strategic: 'strategic, precise, and confident — demonstrating systems-level thinking and enterprise impact without being cold. Authoritative but not stiff.',
    warm: 'warm, personal, and human — showing genuine enthusiasm and personality while maintaining professionalism.',
    executive: 'executive-level confidence — direct, authoritative, and commanding. Every sentence earns its place.'
  };

  showLoading('cl-loading');
  hideError('cl-error');
  document.getElementById('cl-result').classList.remove('visible');

  const systemPrompt = `You are an expert cover letter writer who specializes in crafting highly personalized, compelling cover letters for senior design strategy and service design professionals. You never write generic letters — every sentence is specific, grounded in actual accomplishments, and directly relevant to the target role.`;

  const userMsg = `Write a compelling cover letter for Cara Brown applying to the following role.

JOB DESCRIPTION:
${jd}
${savedRoleName ? `Role: ${savedRoleName}` : ''}
${savedJDUrl ? `URL: ${savedJDUrl}` : ''}

CARA'S RESUME (use this as the primary source):
${resume.text}

ADDITIONAL CONTEXT ABOUT CARA:
${CARA_BIO}
Website: caraabrown.com — case studies and work samples available there.

TONE: ${toneMap[selectedCLTone]}

REQUIREMENTS:
- Address the specific requirements in the JD directly
- Reference 2-3 specific, quantified accomplishments from the resume that are most relevant
- Connect Cara's background explicitly to what the company/role needs
- Mention caraabrown.com naturally as a source for case studies/portfolio
- Do NOT use clichés like "I am excited to apply" or "I am a perfect fit"
- Length: 3-4 tight paragraphs
- Do not include [placeholder] brackets — write the full letter with all details filled in
- End with a strong, confident closing
- Format as a proper letter with date, greeting, body, closing`;

  try {
    const output = document.getElementById('cl-output');
    output.textContent = '';
    document.getElementById('cl-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('cl-error', 'Something went wrong: ' + err.message);
    document.getElementById('cl-result').classList.remove('visible');
  } finally {
    hideLoading('cl-loading');
  }
});

// ─── WHY THIS JOB ─────────────────────────────────────────────────────────────
document.getElementById('gen-why-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  if (!jd) { showError('why-error', 'Please save a job description in Step 01 first.'); return; }

  const context = document.getElementById('why-context').value.trim();

  showLoading('why-loading');
  hideError('why-error');
  document.getElementById('why-result').classList.remove('visible');

  const systemPrompt = `You are an expert career coach helping senior professionals craft authentic, compelling answers to application essay questions. Your answers are specific, grounded in real experience, and never generic.`;

  const userMsg = `Help Cara Brown answer two questions for this job application:

1. "Why did you choose to apply for this role?"
2. "Why would you be a great fit for this position?"

JOB DESCRIPTION:
${jd}
${savedRoleName ? `Role: ${savedRoleName}` : ''}

CARA'S BACKGROUND:
${CARA_BIO}

${RESUMES.principal_ds.text.substring(0, 2000)}

${context ? `ADDITIONAL PERSONAL NOTES FROM CARA:\n${context}` : ''}

REQUIREMENTS:
- Write these as if Cara is speaking in first person
- Be authentic, specific, and grounded — not generic
- Reference specific elements from the JD that resonate with Cara's actual experience
- Draw on real accomplishments from her background
- Keep each answer to 2-3 focused paragraphs
- Make the connection between her unique trajectory and this specific role feel natural and inevitable

Format as:
WHY I CHOSE THIS ROLE:
[answer]

WHY I WILL BE A GREAT FIT:
[answer]`;

  try {
    const output = document.getElementById('why-output');
    output.textContent = '';
    document.getElementById('why-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('why-error', 'Something went wrong: ' + err.message);
    document.getElementById('why-result').classList.remove('visible');
  } finally {
    hideLoading('why-loading');
  }
});

// ─── CUSTOM Q&A ───────────────────────────────────────────────────────────────
document.getElementById('gen-qa-btn').addEventListener('click', async () => {
  const question = document.getElementById('custom-question').value.trim();
  if (!question) { showError('qa-error', 'Please enter a question.'); return; }

  const wordLimit = document.getElementById('word-limit').value.trim();
  const jd = savedJD;

  showLoading('qa-loading');
  hideError('qa-error');
  document.getElementById('qa-result').classList.remove('visible');

  const systemPrompt = `You are an expert career coach helping senior design strategists craft specific, compelling, and authentic answers to job application questions. Every answer is grounded in real experience and never generic.`;

  const userMsg = `Answer the following application question on behalf of Cara Brown.

QUESTION: ${question}
${wordLimit ? `WORD/LENGTH LIMIT: ${wordLimit}` : ''}

${jd ? `JOB CONTEXT:\n${jd}\n` : ''}
${savedRoleName ? `Role: ${savedRoleName}\n` : ''}

CARA'S BACKGROUND:
${CARA_BIO}

KEY ACCOMPLISHMENTS TO DRAW FROM:
${RESUMES.principal_ds.text.substring(0, 2500)}

REQUIREMENTS:
- Write in first person as Cara
- Use specific, quantified examples wherever possible
- Be authentic — draw on her actual experience at Kroger, The RealReal, Foster Brand, EOYDC, Lamont Bishop Gallery, and Alanne International
- Match the word limit if provided
- Do not use clichés or generic statements — every claim should be supported by evidence from her background
- Write in a confident, professional tone

Write the answer directly (no preamble).`;

  try {
    const output = document.getElementById('qa-output');
    output.textContent = '';
    document.getElementById('qa-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('qa-error', 'Something went wrong: ' + err.message);
    document.getElementById('qa-result').classList.remove('visible');
  } finally {
    hideLoading('qa-loading');
  }
});


// ─── SETTINGS MODAL ───────────────────────────────────────────────────────────
function updateKeyStatus() {
  const key = localStorage.getItem('cara_api_key') || '';
  const msg = document.getElementById('key-status-msg');
  const btn = document.getElementById('settings-open-btn');
  if (key) {
    msg.textContent = '✓ API key saved (' + key.substring(0,12) + '…)';
    msg.className = 'key-status set';
    btn.className = 'settings-btn key-set';
    btn.textContent = '✓ API Key Set';
  } else {
    msg.textContent = 'No API key saved — tools will not work without one.';
    msg.className = 'key-status unset';
    btn.className = 'settings-btn';
    btn.textContent = '⚙ API Key';
  }
}

document.getElementById('settings-open-btn').addEventListener('click', () => {
  const key = localStorage.getItem('cara_api_key') || '';
  document.getElementById('api-key-input').value = key ? key : '';
  updateKeyStatus();
  document.getElementById('settings-modal').classList.add('open');
});
document.getElementById('settings-close-btn').addEventListener('click', () => {
  document.getElementById('settings-modal').classList.remove('open');
});
document.getElementById('settings-modal').addEventListener('click', (e) => {
  if (e.target === document.getElementById('settings-modal')) {
    document.getElementById('settings-modal').classList.remove('open');
  }
});
document.getElementById('save-key-btn').addEventListener('click', () => {
  const key = document.getElementById('api-key-input').value.trim();
  if (!key || !key.startsWith('sk-')) {
    alert('Please enter a valid Anthropic API key (starts with sk-).');
    return;
  }
  localStorage.setItem('cara_api_key', key);
  updateKeyStatus();
  setTimeout(() => document.getElementById('settings-modal').classList.remove('open'), 800);
});
document.getElementById('clear-key-btn').addEventListener('click', () => {
  localStorage.removeItem('cara_api_key');
  document.getElementById('api-key-input').value = '';
  updateKeyStatus();
});

// Init key status on load
updateKeyStatus();

// ─── RESUME LINKS ────────────────────────────────────────────────────────────
const RESUME_LINK_KEYS = {
  'rl-principal-ds': 'rl_principal_ds',
  'rl-principal-ds-brief': 'rl_principal_ds_brief',
  'rl-service-designer': 'rl_service_designer',
  'rl-product-designer': 'rl_product_designer',
  'rl-chief-of-staff': 'rl_chief_of_staff'
};

function loadResumeLinks() {
  Object.entries(RESUME_LINK_KEYS).forEach(([inputId, storageKey]) => {
    const val = localStorage.getItem(storageKey) || '';
    const el = document.getElementById(inputId);
    if (el) el.value = val;
  });
}

function copyResumeLink(inputId) {
  const el = document.getElementById(inputId);
  if (!el || !el.value.trim()) {
    alert('No link saved for this resume yet. Paste the URL and click Save Resume Links first.');
    return;
  }
  navigator.clipboard.writeText(el.value.trim()).then(() => {
    // Find the button next to this input and flash it
    const btn = el.nextElementSibling;
    if (btn) { btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = 'Copy', 2000); }
  });
}

document.getElementById('save-resume-links-btn').addEventListener('click', () => {
  Object.entries(RESUME_LINK_KEYS).forEach(([inputId, storageKey]) => {
    const el = document.getElementById(inputId);
    if (el) localStorage.setItem(storageKey, el.value.trim());
  });
  const msg = document.getElementById('resume-links-saved-msg');
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 2500);
});

// Load saved links when settings modal opens
document.getElementById('settings-open-btn').addEventListener('click', loadResumeLinks, { capture: true });

// Init on page load too
loadResumeLinks();



// ─── JOB TRACKER ──────────────────────────────────────────────────────────────
let jobs = JSON.parse(localStorage.getItem('cara_jobs') || '[]');

function saveJobs() {
  localStorage.setItem('cara_jobs', JSON.stringify(jobs));
}

function getWeekStart() {
  const now = new Date();
  const day = now.getDay(); // 0=Sun
  const diff = now.getDate() - day + (day === 0 ? -6 : 1); // Monday
  const mon = new Date(now.setDate(diff));
  mon.setHours(0,0,0,0);
  return mon;
}

function updateTrackerStats() {
  const total = jobs.length;
  const weekStart = getWeekStart();
  const weekApps = jobs.filter(j => {
    const d = new Date(j.dateAdded || j.dateApplied || j.dateAdded);
    return d >= weekStart;
  }).length;
  const active = jobs.filter(j => (j.screening || j.interview) && !j.hired && !j.rejected).length;

  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-week').textContent = weekApps;
  document.getElementById('stat-active').textContent = active;

  // Weeks since first application
  if (jobs.length > 0) {
    const sorted = [...jobs].sort((a, b) => new Date(a.dateAdded || a.dateApplied) - new Date(b.dateAdded || b.dateApplied));
    const firstDate = new Date(sorted[0].dateAdded || sorted[0].dateApplied);
    const now = new Date();
    const diffDays = Math.floor((now - firstDate) / (1000 * 60 * 60 * 24));
    const weeks = Math.floor(diffDays / 7);
    const days = diffDays % 7;
    document.getElementById('stat-weeks').textContent = weeks === 0 ? '<1' : weeks;
    document.getElementById('stat-since').textContent = weeks === 0
      ? 'Started ' + diffDays + ' day(s) ago'
      : 'Since ' + firstDate.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
  } else {
    document.getElementById('stat-weeks').textContent = '—';
    document.getElementById('stat-since').textContent = 'Since first application';
  }

  // Goal bar (35/week)
  const pct = Math.min(100, Math.round((weekApps / 35) * 100));
  document.getElementById('goal-bar-fill').style.width = pct + '%';
  document.getElementById('goal-bar-pct').textContent = weekApps + ' / 35  (' + pct + '%)';
}

function formatDate(isoStr) {
  const d = new Date(isoStr);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

function renderJobs() {
  updateTrackerStats();
  const tbody = document.getElementById('jobs-tbody');
  const empty = document.getElementById('jobs-empty');
  const tableWrap = document.getElementById('jobs-table-wrap');

  if (jobs.length === 0) {
    empty.style.display = 'block';
    tableWrap.style.display = 'none';
    return;
  }
  empty.style.display = 'none';
  tableWrap.style.display = 'block';

  // Sort: hired at bottom, then by date desc
  const sorted = [...jobs].sort((a, b) => {
    if (a.hired && !b.hired) return 1;
    if (!a.hired && b.hired) return -1;
    return new Date(b.dateApplied) - new Date(a.dateApplied);
  });

  tbody.innerHTML = sorted.map(j => {
    const isHired = j.hired ? 'hired-row' : '';
    const urlCell = j.url
      ? `<a class="job-link" href="${j.url}" target="_blank">↗</a>`
      : '';
    const isRejected = j.rejected ? 'style="opacity:0.5;"' : '';
    return `<tr class="${isHired}" data-id="${j.id}" ${isRejected}>
      <td><strong>${escHtml(j.company)}</strong> ${urlCell}</td>
      <td>${escHtml(j.role)}</td>
      <td><span class="applied-date">${formatDate(j.dateAdded || j.dateApplied || new Date().toISOString())}</span></td>
      <td style="text-align:center;">
        <div class="stage-check-item">
          <input type="checkbox" ${j.screening ? 'checked' : ''} onchange="toggleStage('${j.id}','screening',this.checked)">
          <span>Screen</span>
        </div>
      </td>
      <td style="text-align:center;">
        <div class="stage-check-item">
          <input type="checkbox" ${j.interview ? 'checked' : ''} onchange="toggleStage('${j.id}','interview',this.checked)">
          <span>Interview</span>
        </div>
      </td>
      <td style="text-align:center;">
        <div class="stage-check-item">
          <input type="checkbox" ${j.rejected ? 'checked' : ''} onchange="toggleStage('${j.id}','rejected',this.checked)">
          <span>Rejected</span>
        </div>
      </td>
      <td style="text-align:center;">
        <div class="stage-check-item">
          <input type="checkbox" ${j.hired ? 'checked' : ''} onchange="toggleStage('${j.id}','hired',this.checked)">
          <span>Hired!</span>
        </div>
      </td>
      <td><button class="delete-job-btn" onclick="deleteJob('${j.id}')" title="Remove">✕</button></td>
    </tr>`;
  }).join('');
}

function escHtml(str) {
  return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function toggleStage(id, field, val) {
  const job = jobs.find(j => j.id === id);
  if (!job) return;
  job[field] = val;
  if (field === 'applied' && val && !job.dateApplied) {
    job.dateApplied = new Date().toISOString();
  }
  saveJobs();
  renderJobs();
}

function deleteJob(id) {
  if (!confirm('Remove this application from your tracker?')) return;
  jobs = jobs.filter(j => j.id !== id);
  saveJobs();
  renderJobs();
}

// Jobs added automatically from Step 01


// ─── LINKEDIN OUTREACH ────────────────────────────────────────────────────────
let selectedLIType = 'connect';

document.querySelectorAll('#li-type-tabs .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#li-type-tabs .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    selectedLIType = tab.dataset.litype;
  });
});

document.getElementById('gen-li-btn').addEventListener('click', async () => {
  const liName = document.getElementById('li-name').value.trim();
  const liTitle = document.getElementById('li-title').value.trim();
  if (!liName || !liTitle) { showError('li-error', "Please enter the person's name and title."); return; }

  const liContext = document.getElementById('li-context').value.trim();
  const liGoal = document.getElementById('li-goal').value.trim();

  const typeMap = {
    connect: 'a LinkedIn connection request (300 character limit — must be tight, specific, and earn the accept)',
    info: 'an informational interview request sent via LinkedIn message (~150 words max, goal is a 20-minute call)',
    referral: 'a referral request (respectful, specific, makes it easy for them to say yes or pass along)',
    followup: 'a follow-up message after applying online (shows initiative, not desperate)'
  };

  showLoading('li-loading');
  hideError('li-error');
  document.getElementById('li-result').classList.remove('visible');

  const systemPrompt = 'You are an expert at writing LinkedIn outreach that gets replies. You write messages that feel human and specific — never templates. Senior professionals only reply to messages that signal real thought.';

  const userMsg = [
    'Write ' + typeMap[selectedLIType] + ' for Cara Brown to send to ' + liName + ', ' + liTitle + '.',
    liContext ? 'What Cara knows about them: ' + liContext : null,
    liGoal ? 'Goal: ' + liGoal : null,
    savedRoleName ? 'Role context: ' + savedRoleName : null,
    'Cara background: ' + CARA_BIO,
    'Requirements: Write in Caras voice — confident, warm, human. Be specific to THIS person. ' +
    'Do NOT use these phrases: I came across your profile, I hope this finds you well, pick your brain. ' +
    'Connection requests must be under 300 characters. All other types under 150 words. ' +
    'End with a clear low-friction ask. Write the message ready to copy and paste, then add 1-2 sentences on why this approach works.'
  ].filter(Boolean).join('\n\n');
    try {
    const output = document.getElementById('li-output');
    output.textContent = '';
    document.getElementById('li-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('li-error', 'Error: ' + err.message);
    document.getElementById('li-result').classList.remove('visible');
  } finally {
    hideLoading('li-loading');
  }
});

// ─── COMPANY RESEARCH ─────────────────────────────────────────────────────────
let selectedResearchDepth = 'standard';
document.querySelectorAll('#research-depth-tabs .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#research-depth-tabs .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    selectedResearchDepth = tab.dataset.depth;
  });
});

document.getElementById('gen-research-btn').addEventListener('click', async () => {
  const companyName = document.getElementById('company-name').value.trim();
  if (!companyName) { showError('research-error', 'Please enter a company name.'); return; }

  const companyUrl = document.getElementById('company-url').value.trim();
  const companyNotes = document.getElementById('company-notes').value.trim();

  const depthMap = {
    standard: 'a focused 1-page brief: mission/values, strategic priorities, culture signals, and how Cara maps to their needs',
    deep: 'a comprehensive deep-dive: mission/values, leadership, business model, recent news, challenges, competitive positioning, culture, and detailed Cara-fit analysis',
    interview: 'a pre-interview brief: key talking points, smart questions to ask, culture red flags, and what they will evaluate in this stage'
  };

  showLoading('research-loading');
  hideError('research-error');
  document.getElementById('research-result').classList.remove('visible');

  const systemPrompt = 'You are an expert corporate intelligence analyst and career strategist. You synthesize company research into actionable briefs that help senior professionals walk into interviews with confidence.';

  const userMsg = [
    'Build ' + depthMap[selectedResearchDepth] + ' for Cara Brown on: ' + companyName,
    companyUrl ? 'Website: ' + companyUrl : null,
    companyNotes ? 'What Cara knows: ' + companyNotes : null,
    savedJD ? 'Job Description: ' + savedJD.substring(0, 1500) : null,
    'Cara background: ' + CARA_BIO,
    'Structure with these headers: 1. COMPANY SNAPSHOT  2. MISSION, VALUES & CULTURE  3. STRATEGIC PRIORITIES  4. WHAT THEY ARE REALLY LOOKING FOR  5. HOW CARA MAPS TO THEIR WORLD  6. SMART QUESTIONS TO ASK  7. WATCH-OUTS'
  ].filter(Boolean).join('\n\n');
  
  try {
    const output = document.getElementById('research-output');
    output.textContent = '';
    document.getElementById('research-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('research-error', 'Error: ' + err.message);
    document.getElementById('research-result').classList.remove('visible');
  } finally {
    hideLoading('research-loading');
  }
});

// ─── INTERVIEW PREP ───────────────────────────────────────────────────────────
let selectedInterviewStage = 'phone';
let selectedInterviewResume = 'principal_ds';

document.querySelectorAll('#interview-stage-tabs .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#interview-stage-tabs .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    selectedInterviewStage = tab.dataset.stage;
  });
});

document.querySelectorAll('#interview-resume-pills .pill').forEach(pill => {
  pill.addEventListener('click', () => {
    document.querySelectorAll('#interview-resume-pills .pill').forEach(p => p.classList.remove('selected'));
    pill.classList.add('selected');
    selectedInterviewResume = pill.dataset.resume;
  });
});

document.getElementById('gen-interview-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  if (!jd) { showError('interview-error', 'Please save a job description in Step 01 first.'); return; }

  const focus = document.getElementById('interview-focus').value.trim();
  const resume = RESUMES[selectedInterviewResume];

  const stageMap = {
    phone: 'a recruiter phone screen (20-30 min, covers background, fit, salary)',
    hiring: 'a hiring manager interview (45-60 min, goes deep on approach, projects, leadership)',
    panel: 'a panel or final-round interview (multiple interviewers, may include case or presentation)'
  };

  showLoading('interview-loading');
  hideError('interview-error');
  document.getElementById('interview-result').classList.remove('visible');

  const systemPrompt = 'You are a world-class interview coach for senior design strategy roles. You prepare candidates with specific story-based answers — never generic advice. Every answer is grounded in real experience.';

  const userMsg = [
    'Build a complete interview prep guide for Cara Brown.',
    'Stage: ' + stageMap[selectedInterviewStage],
    'Job Description: ' + jd.substring(0, 1500),
    'Resume (' + resume.label + '): ' + resume.text.substring(0, 2500),
    focus ? 'Caras focus or concerns: ' + focus : null,
    'Generate: PART 1 — 60-SECOND OPENER: Write Caras tell me about yourself for this role. 4-5 sentences. PART 2 — 10 MOST LIKELY QUESTIONS + STAR ANSWERS: For each, write the question then a complete STAR answer from Caras real experience. Bold each result and metric. PART 3 — LANDMINES TO WATCH: 2-3 tricky questions and exactly how to handle them.'
  ].filter(Boolean).join('\n\n');
  
  try {
    const output = document.getElementById('interview-output');
    output.textContent = '';
    document.getElementById('interview-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('interview-error', 'Error: ' + err.message);
    document.getElementById('interview-result').classList.remove('visible');
  } finally {
    hideLoading('interview-loading');
  }
});

// ─── SALARY & RECRUITER INTEL ─────────────────────────────────────────────────
let salaryMode = 'salary';

document.querySelectorAll('#salary-mode-tabs .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#salary-mode-tabs .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    salaryMode = tab.dataset.salmode;
    document.getElementById('salary-sub').style.display = salaryMode === 'salary' ? 'block' : 'none';
    document.getElementById('recruiter-sub').style.display = salaryMode === 'recruiter' ? 'block' : 'none';
  });
});

document.getElementById('gen-salary-btn').addEventListener('click', async () => {
  const role = document.getElementById('sal-role').value.trim();
  if (!role) { showError('salary-error', 'Please enter the role title.'); return; }

  const location = document.getElementById('sal-location').value.trim();
  const companyType = document.getElementById('sal-company-type').value.trim();
  const offered = document.getElementById('sal-offered').value.trim();
  const situation = document.getElementById('sal-situation').value.trim();

  showLoading('salary-loading');
  hideError('salary-error');
  document.getElementById('salary-result').classList.remove('visible');

  const systemPrompt = 'You are an expert salary negotiation coach with deep knowledge of design, strategy, and consulting markets. Give specific numbers and exact language — not platitudes.';

  const userMsg = [
    'Build a salary research brief and negotiation strategy for Cara Brown.',
    'Role: ' + role,
    location ? 'Location: ' + location : null,
    companyType ? 'Company type: ' + companyType : null,
    offered ? 'Offered or mentioned: ' + offered : null,
    situation ? 'Situation: ' + situation : null,
    'Cara: 15+ years, MBA, Principal-level, $270M enterprise impact, C-suite partnerships.',
    'Provide: 1. MARKET RATE — realistic ranges by level and sector  2. CARAS NUMBERS — target, floor, stretch. Be direct with specific dollar amounts.  3. NEGOTIATION SCRIPTS — exact language for: salary expectations question, countering a lowball, asking for time, negotiating total comp beyond base  4. TRAPS TO AVOID — 3-4 specific mistakes and how to handle them'
  ].filter(Boolean).join('\n\n');
  
  try {
    const output = document.getElementById('salary-output');
    output.textContent = '';
    document.getElementById('salary-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('salary-error', 'Error: ' + err.message);
    document.getElementById('salary-result').classList.remove('visible');
  } finally {
    hideLoading('salary-loading');
  }
});

document.getElementById('gen-recruiter-btn').addEventListener('click', async () => {
  const recRole = document.getElementById('rec-role').value.trim();
  const recInfo = document.getElementById('rec-info').value.trim();
  if (!recRole || !recInfo) { showError('recruiter-error', 'Please enter the role and recruiter details.'); return; }

  const recJD = document.getElementById('rec-jd').value.trim();

  showLoading('recruiter-loading');
  hideError('recruiter-error');
  document.getElementById('recruiter-result').classList.remove('visible');

  const systemPrompt = 'You are an expert in recruiting industry dynamics and candidate protection. You help senior professionals navigate complex recruiter situations — spotting fakes, avoiding duplicate submissions, protecting their candidacy. Be direct and specific.';

  const userMsg = [
    'Help Cara Brown analyze this recruiter situation.',
    'Role: ' + recRole,
    'Recruiter details: ' + recInfo,
    recJD ? 'JD or details shared: ' + recJD : null,
    'Provide: 1. SITUATION ASSESSMENT — what is likely happening  2. RECRUITER LEGITIMACY — for each recruiter: tier (primary/secondary/body shop), red flags, green flags  3. DUPLICATE SUBMISSION RISK — what happens if two agencies submit her, how to protect herself  4. WHO TO RESPOND TO — specific recommendation and in what order  5. QUESTIONS TO ASK BEFORE CONSENTING — exact questions to ask each recruiter  6. PROTOCOL GOING FORWARD — standard process to avoid this again'
  ].filter(Boolean).join('\n\n');
  
  try {
    const output = document.getElementById('recruiter-output');
    output.textContent = '';
    document.getElementById('recruiter-result').classList.add('visible');
    await callClaude(systemPrompt, userMsg, text => { output.textContent = text; });
  } catch (err) {
    showError('recruiter-error', 'Error: ' + err.message);
    document.getElementById('recruiter-result').classList.remove('visible');
  } finally {
    hideLoading('recruiter-loading');
  }
});



// Init tracker on load
renderJobs();


// ─── LINE-BY-LINE EDITS ──────────────────────────────────────────────────────
let selectedLeResume = 'principal_ds';
let selectedLeFocus = 'full';
let atsHighestResume = null; // set by ATS check when it runs

document.querySelectorAll('#le-resume-pills .pill').forEach(pill => {
  pill.addEventListener('click', () => {
    document.querySelectorAll('#le-resume-pills .pill').forEach(p => p.classList.remove('selected'));
    pill.classList.add('selected');
    selectedLeResume = pill.dataset.resume;
    // Hide the auto-hint if user manually picks
    document.getElementById('le-auto-hint').style.display = 'none';
  });
});

document.querySelectorAll('#le-focus-tabs .tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('#le-focus-tabs .tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    selectedLeFocus = tab.dataset.lefocus;
  });
});

function autoSelectBestResume(resumeKey, resumeLabel) {
  atsHighestResume = resumeKey;
  // Update pills
  document.querySelectorAll('#le-resume-pills .pill').forEach(p => {
    p.classList.toggle('selected', p.dataset.resume === resumeKey);
  });
  selectedLeResume = resumeKey;
  // Show hint
  document.getElementById('le-auto-resume-name').textContent = resumeLabel;
  document.getElementById('le-auto-hint').style.display = 'block';
}

document.getElementById('gen-edits-btn').addEventListener('click', async () => {
  const jd = savedJD || document.getElementById('jd-text').value.trim();
  if (!jd) { showError('le-error', 'Please save a job description in Step 01 first.'); return; }

  const resume = RESUMES[selectedLeResume];
  const focusMap = {
    full: 'every section of the resume — synopsis, core competencies, and all experience bullets',
    summary: 'only the Synopsis / professional summary section at the top',
    competencies: 'only the Core Competencies / Skills sections',
    bullets: 'only the experience bullet points under each role'
  };

  showLoading('le-loading');
  hideError('le-error');
  document.getElementById('le-result').classList.remove('visible');

  const systemPrompt = `You are a senior resume editor and ATS optimization specialist. You produce precise, surgical edits — showing the exact original text, the exact replacement text, and a clear one-line reason for each change. You never give vague advice. Every edit is a specific, copyable rewrite that directly improves ATS keyword matching and relevance scoring for the target job description.`;

  const userMsg = `Perform a line-by-line ATS edit of the following resume against this job description. Focus on: ${focusMap[selectedLeFocus]}.

JOB DESCRIPTION:
${jd}
${savedRoleName ? `Role: ${savedRoleName}` : ''}

RESUME TO EDIT (${resume.label}):
${resume.text}

YOUR TASK:
1. First, output a one-line SUMMARY like this (required, exact format):
EDIT_SUMMARY: [N] edits needed | Projected score: [XX]% → 96%+

2. Then produce line-by-line edits. For EVERY line or bullet that needs changing, output a block in this EXACT format:

SECTION: [e.g., Synopsis / Core Competencies / Kroger Bullets / Education]
BEFORE: [exact original text, copied verbatim]
AFTER: [your rewritten version — complete, ready to paste]
WHY: [one sentence explaining the specific ATS improvement this makes]

RULES:
- Only output edits for lines that ACTUALLY need changing — do not include lines that are already strong
- AFTER text must be complete and ready to paste — no [brackets], no placeholders
- Each AFTER rewrite must naturally incorporate missing JD keywords without sounding forced
- Preserve Cara's voice, first-person implied bullet style, and quantified metrics
- Do not invent accomplishments — only reframe existing ones using JD language
- Prioritize: (1) missing hard keywords, (2) missing soft skills the JD emphasizes, (3) title/seniority alignment, (4) verb choice
- If a bullet needs a keyword added, work it in naturally at the start or end
- For competencies, add missing keyword clusters as new pipe-separated entries

Output nothing else — just the EDIT_SUMMARY line followed by the edit blocks.`;

  try {
    const output = document.getElementById('le-output');
    output.textContent = '';
    document.getElementById('le-result').classList.add('visible');

    let fullText = '';
    await callClaude(systemPrompt, userMsg, (text) => {
      fullText = text;
      // Show raw text while streaming, render structured view only when done
      output.textContent = text;
    });
    // Now render the full structured diff view
    renderEditBlocks(fullText, output);

  } catch (err) {
    showError('le-error', 'Something went wrong: ' + err.message);
    document.getElementById('le-result').classList.remove('visible');
  } finally {
    hideLoading('le-loading');
  }
});

function renderEditBlocks(rawText, container) {
  // Parse the summary line
  const summaryMatch = rawText.match(/EDIT_SUMMARY:\s*(.+)/);
  const editsMatch = summaryMatch ? summaryMatch[1].match(/(\d+)\s*edits/) : null;
  const projMatch = summaryMatch ? summaryMatch[1].match(/(\d+)%\s*[→-]\s*([\d+%]+)/) : null;

  let html = '';

  // Summary bar
  if (summaryMatch) {
    const numEdits = editsMatch ? editsMatch[1] : '?';
    const fromScore = projMatch ? projMatch[1] + '%' : '—';
    const toScore = projMatch ? projMatch[2] : '96%+';
    html += `<div class="edits-summary-bar">
      <div>
        <div class="summary-num">${numEdits}</div>
        <div class="summary-text">edits to apply<br>to reach target score</div>
      </div>
      <div class="projected-score">
        <div class="score-big">${toScore}</div>
        <div class="score-tiny">Projected ATS score<br>(from ${fromScore})</div>
      </div>
    </div>`;
  }

  // Split into blocks by splitting on lines that start with SECTION: or BEFORE:
  // Use string splitting instead of regex to avoid newline-in-regex issues
  const lines = rawText.split('\n');
  let blocks = [];
  let currentBlock = [];

  for (const line of lines) {
    const trimmed = line.trim();
    if ((trimmed.startsWith('SECTION:') || trimmed.startsWith('BEFORE:')) && currentBlock.length > 0) {
      // Check if currentBlock has a BEFORE: — if so it's a real block
      if (currentBlock.some(l => l.trim().startsWith('BEFORE:'))) {
        blocks.push(currentBlock.join('\n'));
      }
      currentBlock = [line];
    } else {
      currentBlock.push(line);
    }
  }
  if (currentBlock.some(l => l.trim().startsWith('BEFORE:'))) {
    blocks.push(currentBlock.join('\n'));
  }

  blocks.forEach((block, i) => {
    // Parse each field using indexOf-based extraction
    function extractField(text, fieldName, nextFields) {
      const marker = fieldName + ':';
      const start = text.indexOf(marker);
      if (start < 0) return '';
      let end = text.length;
      for (const next of nextFields) {
        const ni = text.indexOf(next + ':', start + marker.length);
        if (ni > 0 && ni < end) end = ni;
      }
      return text.substring(start + marker.length, end).trim();
    }

    const section = extractField(block, 'SECTION', ['BEFORE','AFTER','WHY']);
    const before  = extractField(block, 'BEFORE',  ['AFTER','WHY','SECTION']);
    const after   = extractField(block, 'AFTER',   ['WHY','SECTION','BEFORE']);
    const why     = extractField(block, 'WHY',     ['SECTION','BEFORE','AFTER']);

    if (!before && !after) return;

    const editId = 'edit-block-' + i;
    html += `<div class="edit-block" id="${editId}">
      <div class="edit-block-header">
        <span>Edit ${i + 1}</span>
        ${section ? `<span class="edit-section-label">${escHtml(section)}</span>` : ''}
        <button class="copy-btn" style="margin-left:auto;padding:0.2rem 0.6rem;font-size:0.7rem;" onclick="(function(btn){const txt=btn.closest('.edit-block').querySelector('.edit-row-after').textContent.replace('Replace with','').trim();navigator.clipboard.writeText(txt).then(()=>{btn.textContent='Copied!';setTimeout(()=>btn.textContent='Copy',2000);})})(this)">Copy</button>
      </div>
      <div class="edit-row-before"><span class="edit-label">Remove</span>${escHtml(before)}</div>
      <div class="edit-row-after"><span class="edit-label">Replace with</span>${escHtml(after)}</div>
      ${why ? `<div class="edit-row-why">💡 ${escHtml(why)}</div>` : ''}
    </div>`;
  });

  if (blocks.length === 0 && !summaryMatch) {
    container.textContent = rawText;
    return;
  }

  container.innerHTML = html || `<div style="white-space:pre-wrap;font-size:0.85rem;">${escHtml(rawText)}</div>`;
}



// ─── ATS OUTPUT TABS ──────────────────────────────────────────────────────────
document.getElementById('ats-output-tabs').addEventListener('click', e => {
  const tab = e.target.closest('.tab');
  if (!tab) return;
  document.querySelectorAll('#ats-output-tabs .tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  const sec = tab.dataset.atssec;
  document.getElementById('ats-flags-output').style.display = sec === 'flags' ? 'block' : 'none';
  document.getElementById('ats-summary-output').style.display = sec === 'summary' ? 'block' : 'none';
});

// ─── RECHECK OUTPUT TABS ──────────────────────────────────────────────────────
document.getElementById('recheck-tabs').addEventListener('click', e => {
  const tab = e.target.closest('.tab');
  if (!tab) return;
  document.querySelectorAll('#recheck-tabs .tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  const sec = tab.dataset.rcsec;
  ['keywords','improvement','gaps','ready'].forEach(s => {
    document.getElementById('recheck-' + s + '-output').style.display = s === sec ? 'block' : 'none';
  });
});

// ─── HELPERS ──────────────────────────────────────────────────────────────────
function downloadCLasPDF() {
  const text = document.getElementById('cl-output').innerText;
  if (!text.trim()) { alert('Generate a cover letter first.'); return; }
  const win = window.open('', '_blank');
  win.document.write('<html><head><title>Cover Letter</title><style>body{font-family:Georgia,serif;max-width:700px;margin:60px auto;font-size:14px;line-height:1.8;color:#222;}p{margin:0 0 1em;}</style></head><body>');
  text.split('\n').forEach(line => {
    win.document.write('<p>' + line.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</p>');
  });
  win.document.write('</body></html>');
  win.document.close();
  win.print();
}
function showLoading(id) { document.getElementById(id).classList.add('visible'); }
function hideLoading(id) { document.getElementById(id).classList.remove('visible'); }
function showError(id, msg) {
  const el = document.getElementById(id);
  el.textContent = msg;
  el.classList.add('visible');
}
function hideError(id) { 
  const el = document.getElementById(id);
  el.textContent = '';
  el.classList.remove('visible');
}

function copyResult(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const text = el.textContent || el.innerText;
  navigator.clipboard.writeText(text).then(() => {
    // find the copy button near this element
    const btn = el.closest('.result-box')?.querySelector('.copy-btn');
    if (btn) { btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = 'Copy', 2000); }
  });
}
</script>
</body>
</html>
